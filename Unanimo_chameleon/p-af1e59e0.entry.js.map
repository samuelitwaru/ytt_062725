{"version":3,"names":["POPOVER_SEPARATION_X","POPOVER_SEPARATION_Y","positionTryFlipMap","checkIfContentOverflowsWindowY","actionStartPosition","documentSize","popoverSize","popoverRelativePosition","alignToImplementationMap","_","separation","__","center","actionSize","fromPxToNumber","pxValue","Number","replace","trim","getAlignmentValue","align","flipSupport","alignmentOverflowsWindow","oppositeAlign","oppositePopoverRelativePosition","oppositeAlignmentOverflowsWindow","setResponsiveAlignment","documentRect","actionRect","actionInlineStart","popoverWidth","popoverHeight","computedStyle","inlineAlign","blockAlign","positionTry","separationX","getPropertyValue","separationY","inlineAlignmentValue","width","blockAlignmentValue","top","height","popoverCss","ChPopoverStyle0","DRAGGING_CLASS","POPOVER_PREVENT_FLICKERING_CLASS","RESIZING_CLASS","POPOVER_ALIGN_BLOCK","POPOVER_ALIGN_INLINE","POPOVER_ACTION_WIDTH","POPOVER_ACTION_HEIGHT","POPOVER_ACTION_LEFT","POPOVER_ACTION_TOP","POPOVER_DRAGGED_X","POPOVER_DRAGGED_Y","POPOVER_BLOCK_SIZE","POPOVER_INLINE_SIZE","POPOVER_MIN_BLOCK_SIZE","POPOVER_MIN_INLINE_SIZE","POPOVER_BORDER_BLOCK_START_SIZE","POPOVER_BORDER_BLOCK_END_SIZE","POPOVER_BORDER_INLINE_START_SIZE","POPOVER_BORDER_INLINE_END_SIZE","POPOVER_RTL_CLASS","POPOVER_RTL","POPOVER_RTL_VALUE","addCursorInDocument","cursor","document","body","style","resizingCursorDictionary","rtl","setProperty","element","property","value","addPopoverTargetElement","actionElement","popoverElement","addAction","popoverTargetElement","removePopoverTargetElement","undefined","ChPopover","borderSizeRAF","dragRAF","positionAdjustRAF","resizeRAF","adjustAlignment","checkPositionWatcher","checkBorderSizeWatcher","borderSizeObserver","resizeObserver","rtlWatcher","draggedDistanceX","draggedDistanceY","dragging","initialDragEvent","lastDragEvent","isRTLDirection","currentEdge","draggedDistanceXForResize","draggedDistanceYForResize","maxBlockSize","maxInlineSize","minBlockSize","minInlineSize","resizeWasMade","resizeByDirectionDictionary","block","popoverRect","direction","currentDraggedDistanceY","this","clientY","newBlockSize","newRestrictedBlockSize","forceCSSMinMax","el","inline","currentDraggedDistanceX","clientX","newInlineSize","newRestrictedInlineSize","resizeEdgesAndCornersDictionary","resizeLayer","windowRef","handleActionChange","newActionElement","oldActionElement","actionById","handleBlockChange","blockSizeWatchChange","newValue","removeProperty","handleHiddenChange","newHiddenValue","firstLayer","avoidFlickeringInTheNextRender","hidePopover","showPopover","handleInlineChange","inlineSizeWatchChange","resizableChanged","popoverOpened","popoverClosed","addClickOutsideWatcherIfNecessary","handlePopoverCloseOnClickOutside","event","composedPath","includes","removeClickOutsideWatcher","hidden","emit","mode","closeOnClickOutside","addEventListener","passive","removeEventListener","addDraggingClass","classList","add","removeDraggingClass","remove","addClass","setPositionWatcher","removePositionWatcher","disconnect","SyncWithRAF","ResizeObserver","updatePositionRAF","observe","updatePosition","requestAnimationFrame","capture","perform","documentElement","getBoundingClientRect","getComputedStyle","getActionInlineStartPosition","left","getPopoverInlineSizeAndFixItIfNecessary","getPopoverBlockSizeAndFixItIfNecessary","alignment","inlineSizeMatch","blockSizeMatch","handlePopoverToggle","willBeHidden","newState","handleMouseDown","trackElementDragRAF","handleDragEnd","trackElementDrag","preventDefault","cancel","handleEdgeResize","edge","resizing","removeBorderSizeWatcher","trackElementResizeRAF","handleResizeEnd","trackElementResize","setBorderSizeWatcher","resizable","updateBorderSizeRAF","box","updateBorderSize","borderBlockStartWidth","borderBlockEndWidth","borderInlineStartWidth","borderInlineEndWidth","connectedCallback","window","MutationObserver","isRTL","attributeFilter","componentWillRender","componentDidLoad","disconnectedCallback","render","canAddListeners","h","Host","key","class","allowDrag","popover","onMouseDown","onToggle","part","name","ref"],"sources":["src/components/popover/utils.ts","src/components/popover/popover.scss?tag=ch-popover&encapsulation=shadow","src/components/popover/popover.tsx"],"sourcesContent":["import { ChPopoverAlign, ChPopoverPositionTry } from \"./types\";\r\n\r\nconst POPOVER_SEPARATION_X = \"--ch-popover-separation-x\";\r\nconst POPOVER_SEPARATION_Y = \"--ch-popover-separation-y\";\r\n\r\n// Position try\r\nconst positionTryFlipMap = {\r\n  \"outside-start\": \"outside-end\",\r\n  \"outside-end\": \"outside-start\",\r\n  \"inside-start\": \"inside-end\",\r\n  \"inside-end\": \"inside-start\"\r\n} as const satisfies {\r\n  [key in Exclude<ChPopoverAlign, \"center\">]: string;\r\n};\r\n\r\nconst checkIfContentOverflowsWindowY = (\r\n  actionStartPosition: number,\r\n  documentSize: number,\r\n  popoverSize: number,\r\n  popoverRelativePosition: number\r\n) =>\r\n  documentSize < popoverSize + actionStartPosition + popoverRelativePosition ||\r\n  actionStartPosition + popoverRelativePosition < 0;\r\n\r\nconst alignToImplementationMap: {\r\n  [key in ChPopoverAlign]: (\r\n    actionSize: number,\r\n    popoverSize: number,\r\n    separation: number\r\n  ) => number;\r\n} = {\r\n  \"outside-start\": (_, popoverSize, separation) => -popoverSize - separation,\r\n\r\n  \"inside-start\": (_, __, separation) => separation,\r\n\r\n  center: (actionSize, popoverSize, separation) =>\r\n    actionSize * 0.5 + separation - popoverSize * 0.5,\r\n\r\n  \"inside-end\": (actionSize, popoverSize, separation) =>\r\n    actionSize - (separation + popoverSize),\r\n\r\n  \"outside-end\": (actionSize, _, separation) => actionSize + separation\r\n};\r\n\r\nexport const fromPxToNumber = (pxValue: string) =>\r\n  Number(pxValue.replace(\"px\", \"\").trim());\r\n\r\nconst getAlignmentValue = (\r\n  align: ChPopoverAlign,\r\n  actionStartPosition: number,\r\n  actionSize: number,\r\n  popoverSize: number,\r\n  documentSize: number,\r\n  separation: number,\r\n  flipSupport: boolean\r\n) => {\r\n  const popoverRelativePosition = alignToImplementationMap[align](\r\n    actionSize,\r\n    popoverSize,\r\n    separation\r\n  );\r\n\r\n  // The configuration does not support flip\r\n  if (!flipSupport) {\r\n    return popoverRelativePosition;\r\n  }\r\n\r\n  // Check if the current alignment overflows the document window\r\n  const alignmentOverflowsWindow = checkIfContentOverflowsWindowY(\r\n    actionStartPosition,\r\n    documentSize,\r\n    popoverSize,\r\n    popoverRelativePosition\r\n  );\r\n\r\n  if (!alignmentOverflowsWindow) {\r\n    return popoverRelativePosition;\r\n  }\r\n\r\n  // Check the alignment with the opposite alignment\r\n  const oppositeAlign = positionTryFlipMap[align];\r\n  const oppositePopoverRelativePosition = alignToImplementationMap[\r\n    oppositeAlign\r\n  ](actionSize, popoverSize, separation);\r\n\r\n  const oppositeAlignmentOverflowsWindow = checkIfContentOverflowsWindowY(\r\n    actionStartPosition,\r\n    documentSize,\r\n    popoverSize,\r\n    oppositePopoverRelativePosition\r\n  );\r\n\r\n  return oppositeAlignmentOverflowsWindow\r\n    ? popoverRelativePosition\r\n    : oppositePopoverRelativePosition;\r\n};\r\n\r\nexport const setResponsiveAlignment = (\r\n  documentRect: DOMRect,\r\n  actionRect: DOMRect,\r\n  actionInlineStart: number,\r\n  popoverWidth: number,\r\n  popoverHeight: number,\r\n  computedStyle: CSSStyleDeclaration,\r\n  inlineAlign: ChPopoverAlign,\r\n  blockAlign: ChPopoverAlign,\r\n  positionTry: ChPopoverPositionTry\r\n): [number, number] => {\r\n  const separationX = computedStyle.getPropertyValue(POPOVER_SEPARATION_X);\r\n  const separationY = computedStyle.getPropertyValue(POPOVER_SEPARATION_Y);\r\n\r\n  // Alignment\r\n  const inlineAlignmentValue = getAlignmentValue(\r\n    inlineAlign,\r\n    actionInlineStart,\r\n    actionRect.width,\r\n    popoverWidth,\r\n    documentRect.width,\r\n    fromPxToNumber(separationX),\r\n    inlineAlign !== \"center\" && positionTry === \"flip-inline\"\r\n  );\r\n\r\n  const blockAlignmentValue = getAlignmentValue(\r\n    blockAlign,\r\n    actionRect.top,\r\n    actionRect.height,\r\n    popoverHeight,\r\n    documentRect.height,\r\n    fromPxToNumber(separationY),\r\n    blockAlign !== \"center\" && positionTry === \"flip-block\"\r\n  );\r\n\r\n  return [inlineAlignmentValue, blockAlignmentValue];\r\n};\r\n","@import \"../../common/base\";\r\n\r\n@include box-sizing();\r\n\r\n$ch-popover-x: calc(\r\n  (\r\n      var(--ch-popover-action-left) + var(--ch-popover-inline) +\r\n        var(--ch-popover-dragged-x)\r\n    ) * var(--ch-popover-rtl)\r\n);\r\n\r\n$ch-popover-y: calc(\r\n  var(--ch-popover-action-top) + var(--ch-popover-block) +\r\n    var(--ch-popover-dragged-y)\r\n);\r\n\r\n$ch-popover-x--same-layer: calc(\r\n  (var(--ch-popover-inline) + var(--ch-popover-dragged-x)) *\r\n    var(--ch-popover-rtl)\r\n);\r\n\r\n$ch-popover-y--same-layer: calc(\r\n  var(--ch-popover-block) + var(--ch-popover-dragged-y)\r\n);\r\n\r\n:host {\r\n  /**\r\n   * @prop --ch-popover-block-size:\r\n   * Specifies the block size of the popover. Useful for scenarios where the\r\n   * popover is resizable.\r\n   * @default max-content\r\n   */\r\n  --ch-popover-block-size: max-content;\r\n\r\n  /**\r\n   * @prop --ch-popover-inline-size:\r\n   * Specifies the inline size of the popover. Useful for scenarios where the\r\n   * popover is resizable.\r\n   * @default max-content\r\n   */\r\n  --ch-popover-inline-size: max-content;\r\n\r\n  /**\r\n   * @prop --ch-popover-max-block-size:\r\n   * Specifies the maximum block size of the popover. Useful for scenarios where the\r\n   * popover is resizable.\r\n   * @default auto\r\n   */\r\n  --ch-popover-max-block-size: auto;\r\n\r\n  /**\r\n     * @prop --ch-popover-max-inline-size:\r\n     * Specifies the maximum inline size of the popover. Useful for scenarios\r\n     * where the popover is resizable.\r\n     * @default auto\r\n     */\r\n  --ch-popover-max-inline-size: auto;\r\n\r\n  /**\r\n   * @prop --ch-popover-min-block-size:\r\n   * Specifies the minimum block size of the popover. Useful for scenarios where the\r\n   * popover is resizable.\r\n   * @default auto\r\n   */\r\n  --ch-popover-min-block-size: auto;\r\n\r\n  /**\r\n    * @prop --ch-popover-min-inline-size:\r\n    * Specifies the minimum inline size of the popover. Useful for scenarios\r\n    * where the popover is resizable.\r\n    * @default auto\r\n    */\r\n  --ch-popover-min-inline-size: auto;\r\n\r\n  /**\r\n   * @prop --ch-popover-resize-threshold:\r\n   * Specifies the size of the threshold to resize the popover.\r\n   * @default 4px\r\n   */\r\n  --ch-popover-resize-threshold: 8px;\r\n\r\n  /**\r\n   * @prop --ch-popover-separation-x:\r\n   * Specifies the separation between the action and popover in the x axis.\r\n   * @default 0px\r\n   */\r\n  --ch-popover-separation-x: 0px;\r\n\r\n  /**\r\n   * @prop --ch-popover-separation-y:\r\n   * Specifies the separation between the action and popover in the y axis.\r\n   * @default 0px\r\n   */\r\n  --ch-popover-separation-y: 0px;\r\n\r\n  --ch-popover-resize-threshold--half-negative: calc(\r\n    var(--ch-popover-resize-threshold) * -0.5\r\n  );\r\n\r\n  --ch-popover-border-inline-start-width: 0px;\r\n  --ch-popover-border-inline-end-width: 0px;\r\n  --ch-popover-border-block-start-width: 0px;\r\n  --ch-popover-border-block-end-width: 0px;\r\n\r\n  --ch-popover-resize__inline-start: calc(\r\n    var(--ch-popover-resize-threshold--half-negative) -\r\n      var(--ch-popover-border-inline-start-width) * 0.5\r\n  );\r\n\r\n  --ch-popover-resize__inline-end: calc(\r\n    var(--ch-popover-resize-threshold--half-negative) -\r\n      var(--ch-popover-border-inline-end-width) * 0.5\r\n  );\r\n\r\n  --ch-popover-resize__block-start: calc(\r\n    var(--ch-popover-resize-threshold--half-negative) -\r\n      var(--ch-popover-border-block-start-width) * 0.5\r\n  );\r\n\r\n  --ch-popover-resize__block-end: calc(\r\n    var(--ch-popover-resize-threshold--half-negative) -\r\n      var(--ch-popover-border-block-end-width) * 0.5\r\n  );\r\n\r\n  --ch-popover-dragged-x: 0px;\r\n  --ch-popover-dragged-y: 0px;\r\n  --ch-popover-rtl: 1;\r\n\r\n  display: grid; // Necessary to support gap property\r\n\r\n  // Necessary when the popover is not placed in a new top layer. For example,\r\n  // when nesting dropdowns\r\n  position: fixed;\r\n\r\n  inline-size: var(--ch-popover-inline-size);\r\n  block-size: var(--ch-popover-block-size);\r\n  min-inline-size: var(--ch-popover-min-inline-size);\r\n  min-block-size: var(--ch-popover-min-block-size);\r\n  max-inline-size: var(--ch-popover-max-inline-size);\r\n  max-block-size: var(--ch-popover-max-block-size);\r\n\r\n  // Reset browser defaults\r\n  margin: 0;\r\n  padding: 0;\r\n  background-color: unset;\r\n  border: unset;\r\n  color: unset;\r\n  overflow: visible;\r\n\r\n  top: 0;\r\n  inset-inline-start: 0;\r\n\r\n  // Alignment and Drag\r\n  translate: $ch-popover-x $ch-popover-y;\r\n}\r\n\r\n// - - - - - - - - - - - - - - - -\r\n//             Hidden\r\n// - - - - - - - - - - - - - - - -\r\n// :host([hidden]) {\r\n//   display: grid !important;\r\n//   visibility: hidden;\r\n// }\r\n\r\n// // content-visibility: hidden is faster for rendering the content back, as\r\n// // it preserves the rendering state of the content (display: none does not)\r\n// @supports (content-visibility: hidden) {\r\n//   :host([hidden]) {\r\n//     content-visibility: hidden;\r\n//   }\r\n// }\r\n\r\n// @supports not (content-visibility: hidden) {\r\n//   :host([hidden]) {\r\n//     visibility: hidden;\r\n//   }\r\n// }\r\n\r\n// Prevents initial flickering\r\n:host(.gx-popover-prevent-flickering) {\r\n  // Necessary to override visibility: inherit from Stencil's hydration\r\n  visibility: hidden !important;\r\n}\r\n\r\n// - - - - - - - - - - - - - - - -\r\n//              Drag\r\n// - - - - - - - - - - - - - - - -\r\n:host(.gx-popover-header-drag) {\r\n  display: grid;\r\n  grid-template-rows: max-content 1fr;\r\n}\r\n\r\n:host(.gx-popover-dragging) {\r\n  cursor: move;\r\n\r\n  // Remove any type of pointer when dragging, to make \"cursor: move\" effective\r\n  ::slotted(*) {\r\n    pointer-events: none;\r\n    user-select: none;\r\n  }\r\n}\r\n\r\n// - - - - - - - - - - - - - - - -\r\n//            Resizable\r\n// - - - - - - - - - - - - - - - -\r\n:host(.ch-popover-resizing) {\r\n  pointer-events: none;\r\n  user-select: none;\r\n}\r\n\r\n.edge {\r\n  &__block-start,\r\n  &__block-end {\r\n    position: fixed;\r\n    // This calc improves edge positioning when the border-width is much larger\r\n    // than the threshold\r\n    inset-inline: min(\r\n        0px,\r\n        calc(\r\n          (\r\n              var(--ch-popover-resize-threshold) -\r\n                var(--ch-popover-border-inline-start-width)\r\n            ) / 2\r\n        )\r\n      )\r\n      min(\r\n        0px,\r\n        calc(\r\n          (\r\n              var(--ch-popover-resize-threshold) -\r\n                var(--ch-popover-border-inline-end-width)\r\n            ) / 2\r\n        )\r\n      );\r\n    block-size: var(--ch-popover-resize-threshold);\r\n    cursor: ns-resize;\r\n  }\r\n\r\n  &__inline-start,\r\n  &__inline-end {\r\n    position: fixed;\r\n    // This calc improves edge positioning when the border-width is much larger\r\n    // than the threshold\r\n    inset-block: min(\r\n        0px,\r\n        calc(\r\n          (\r\n              var(--ch-popover-resize-threshold) -\r\n                var(--ch-popover-border-block-start-width)\r\n            ) / 2\r\n        )\r\n      )\r\n      min(\r\n        0px,\r\n        calc(\r\n          (\r\n              var(--ch-popover-resize-threshold) -\r\n                var(--ch-popover-border-block-end-width)\r\n            ) / 2\r\n        )\r\n      );\r\n    inline-size: var(--ch-popover-resize-threshold);\r\n    cursor: ew-resize;\r\n  }\r\n\r\n  &__block-start {\r\n    inset-block-start: var(--ch-popover-resize__block-start);\r\n  }\r\n\r\n  &__block-end {\r\n    inset-block-end: var(--ch-popover-resize__block-end);\r\n  }\r\n\r\n  &__inline-start {\r\n    inset-inline-start: var(--ch-popover-resize__inline-start);\r\n  }\r\n\r\n  &__inline-end {\r\n    inset-inline-end: var(--ch-popover-resize__inline-end);\r\n  }\r\n}\r\n\r\n.corner {\r\n  &__block-start-inline-start,\r\n  &__block-end-inline-end {\r\n    position: fixed;\r\n    block-size: var(--ch-popover-resize-threshold);\r\n    inline-size: var(--ch-popover-resize-threshold);\r\n    cursor: nwse-resize;\r\n  }\r\n\r\n  &__block-start-inline-end,\r\n  &__block-end-inline-start {\r\n    position: fixed;\r\n    block-size: var(--ch-popover-resize-threshold);\r\n    inline-size: var(--ch-popover-resize-threshold);\r\n    cursor: nesw-resize;\r\n  }\r\n\r\n  &__block-start-inline-start {\r\n    inset-block-start: var(--ch-popover-resize__block-start);\r\n    inset-inline-start: var(--ch-popover-resize__inline-start);\r\n  }\r\n\r\n  &__block-end-inline-end {\r\n    inset-block-end: var(--ch-popover-resize__block-end);\r\n    inset-inline-end: var(--ch-popover-resize__inline-end);\r\n  }\r\n\r\n  &__block-start-inline-end {\r\n    inset-block-start: var(--ch-popover-resize__block-start);\r\n    inset-inline-end: var(--ch-popover-resize__inline-end);\r\n  }\r\n\r\n  &__block-end-inline-start {\r\n    inset-block-end: var(--ch-popover-resize__block-end);\r\n    inset-inline-start: var(--ch-popover-resize__inline-start);\r\n  }\r\n}\r\n\r\n// \"Rotate\" resize cursors for the corners\r\n:host(.ch-popover-rtl) {\r\n  .corner__block-start-inline-start,\r\n  .corner__block-end-inline-end {\r\n    cursor: nesw-resize;\r\n  }\r\n}\r\n\r\n:host(.ch-popover-rtl) {\r\n  .corner__block-start-inline-end,\r\n  .corner__block-end-inline-start {\r\n    cursor: nwse-resize;\r\n  }\r\n}\r\n\r\n// Useful for observing changes in border size\r\n.resize-layer {\r\n  position: fixed;\r\n  inset: 0;\r\n  pointer-events: none;\r\n}\r\n\r\n// - - - - - - - - - - - - - - - -\r\n//         Block alignment\r\n// - - - - - - - - - - - - - - - -\r\n// :host([block-align=\"outside-start\"]) {\r\n//   --ch-popover-block: calc(-100% + var(--ch-popover-separation-y) * -1);\r\n// }\r\n\r\n// :host([block-align=\"inside-start\"]) {\r\n//   --ch-popover-block: var(--ch-popover-separation-y);\r\n// }\r\n\r\n// :host([block-align=\"center\"]) {\r\n//   --ch-popover-block: calc(\r\n//     var(--ch-popover-action-height) / 2 - 50% + var(--ch-popover-separation-y)\r\n//   );\r\n// }\r\n\r\n// :host([block-align=\"inside-end\"]) {\r\n//   --ch-popover-block: calc(\r\n//     var(--ch-popover-action-height) - (100% + var(--ch-popover-separation-y))\r\n//   );\r\n// }\r\n\r\n// :host([block-align=\"outside-end\"]) {\r\n//   --ch-popover-block: calc(\r\n//     var(--ch-popover-action-height) + var(--ch-popover-separation-y)\r\n//   );\r\n// }\r\n\r\n// // - - - - - - - - - - - - - - - -\r\n// //        Inline alignment\r\n// // - - - - - - - - - - - - - - - -\r\n// :host([inline-align=\"outside-start\"]) {\r\n//   --ch-popover-inline: calc(-100% + var(--ch-popover-separation-x) * -1);\r\n// }\r\n\r\n// :host([inline-align=\"inside-start\"]) {\r\n//   --ch-popover-inline: var(--ch-popover-separation-x);\r\n// }\r\n\r\n// :host([inline-align=\"center\"]) {\r\n//   --ch-popover-inline: calc(\r\n//     var(--ch-popover-action-width) / 2 - 50% + var(--ch-popover-separation-x)\r\n//   );\r\n// }\r\n\r\n// :host([inline-align=\"inside-end\"]) {\r\n//   --ch-popover-inline: calc(\r\n//     var(--ch-popover-action-width) - (100% + var(--ch-popover-separation-x))\r\n//   );\r\n// }\r\n\r\n// :host([inline-align=\"outside-end\"]) {\r\n//   --ch-popover-inline: calc(\r\n//     var(--ch-popover-action-width) + var(--ch-popover-separation-x)\r\n//   );\r\n// }\r\n","import {\r\n  Component,\r\n  Element,\r\n  Event,\r\n  EventEmitter,\r\n  Host,\r\n  Watch,\r\n  Prop,\r\n  State,\r\n  h\r\n} from \"@stencil/core\";\r\nimport {\r\n  ChPopoverAlign,\r\n  ChPopoverResizeElement,\r\n  ChPopoverSizeMatch,\r\n  PopoverActionElement\r\n} from \"./types\";\r\nimport { forceCSSMinMax, isRTL } from \"../../common/utils\";\r\nimport { SyncWithRAF } from \"../../common/sync-with-frames\";\r\nimport { fromPxToNumber, setResponsiveAlignment } from \"./utils\";\r\n\r\nconst DRAGGING_CLASS = \"gx-popover-dragging\";\r\nconst POPOVER_PREVENT_FLICKERING_CLASS = \"gx-popover-prevent-flickering\";\r\nconst RESIZING_CLASS = \"ch-popover-resizing\";\r\n\r\n// Custom vars\r\nconst POPOVER_ALIGN_BLOCK = \"--ch-popover-block\";\r\nconst POPOVER_ALIGN_INLINE = \"--ch-popover-inline\";\r\n\r\nconst POPOVER_ACTION_WIDTH = \"--ch-popover-action-width\";\r\nconst POPOVER_ACTION_HEIGHT = \"--ch-popover-action-height\";\r\nconst POPOVER_ACTION_LEFT = \"--ch-popover-action-left\";\r\nconst POPOVER_ACTION_TOP = \"--ch-popover-action-top\";\r\n\r\nconst POPOVER_DRAGGED_X = \"--ch-popover-dragged-x\";\r\nconst POPOVER_DRAGGED_Y = \"--ch-popover-dragged-y\";\r\n\r\nconst POPOVER_BLOCK_SIZE = \"--ch-popover-block-size\";\r\nconst POPOVER_INLINE_SIZE = \"--ch-popover-inline-size\";\r\n\r\nconst POPOVER_MIN_BLOCK_SIZE = \"--ch-popover-min-block-size\";\r\nconst POPOVER_MIN_INLINE_SIZE = \"--ch-popover-min-inline-size\";\r\n\r\nconst POPOVER_BORDER_BLOCK_START_SIZE = \"--ch-popover-border-block-start-width\";\r\nconst POPOVER_BORDER_BLOCK_END_SIZE = \"--ch-popover-border-block-end-width\";\r\nconst POPOVER_BORDER_INLINE_START_SIZE =\r\n  \"--ch-popover-border-inline-start-width\";\r\nconst POPOVER_BORDER_INLINE_END_SIZE = \"--ch-popover-border-inline-end-width\";\r\n\r\nconst POPOVER_RTL_CLASS = \"ch-popover-rtl\";\r\nconst POPOVER_RTL = \"--ch-popover-rtl\";\r\nconst POPOVER_RTL_VALUE = \"-1\";\r\n\r\nconst addCursorInDocument = (cursor: string) =>\r\n  (document.body.style.cursor = cursor);\r\n\r\nconst resizingCursorDictionary: {\r\n  [key in ChPopoverResizeElement]: (rtl: boolean) => void;\r\n} = {\r\n  \"block-start\": () => addCursorInDocument(\"ns-resize\"),\r\n\r\n  \"block-end\": () => addCursorInDocument(\"ns-resize\"),\r\n\r\n  \"inline-start\": () => addCursorInDocument(\"ew-resize\"),\r\n\r\n  \"inline-end\": () => addCursorInDocument(\"ew-resize\"),\r\n\r\n  \"block-start-inline-start\": rtl =>\r\n    addCursorInDocument(rtl ? \"nesw-resize\" : \"nwse-resize\"),\r\n\r\n  \"block-start-inline-end\": rtl =>\r\n    addCursorInDocument(rtl ? \"nwse-resize\" : \"nesw-resize\"),\r\n\r\n  \"block-end-inline-start\": rtl =>\r\n    addCursorInDocument(rtl ? \"nwse-resize\" : \"nesw-resize\"),\r\n\r\n  \"block-end-inline-end\": rtl =>\r\n    addCursorInDocument(rtl ? \"nesw-resize\" : \"nwse-resize\")\r\n};\r\n\r\n// Utils\r\n\r\nconst setProperty = (element: HTMLElement, property: string, value: number) =>\r\n  element.style.setProperty(property, `${value}px`);\r\n\r\nconst addPopoverTargetElement = (\r\n  actionElement: PopoverActionElement,\r\n  popoverElement: HTMLElement,\r\n  addAction: boolean\r\n) => {\r\n  if (actionElement && addAction) {\r\n    actionElement.popoverTargetElement = popoverElement;\r\n  }\r\n};\r\n\r\nconst removePopoverTargetElement = (actionElement: PopoverActionElement) => {\r\n  if (actionElement) {\r\n    actionElement.popoverTargetElement = undefined;\r\n  }\r\n};\r\n\r\n/**\r\n * The `ch-popover` component represents a popover container that is positioned\r\n * relative to an element, but placed on the top layer using `position: fixed`.\r\n */\r\n@Component({\r\n  tag: \"ch-popover\",\r\n  styleUrl: \"popover.scss\",\r\n  shadow: true\r\n})\r\nexport class ChPopover {\r\n  // Sync computations with frames\r\n  #borderSizeRAF: SyncWithRAF; // Don't allocate memory until needed when dragging\r\n  #dragRAF: SyncWithRAF; // Don't allocate memory until needed when dragging\r\n  #positionAdjustRAF: SyncWithRAF; // Don't allocate memory until needed\r\n  #resizeRAF: SyncWithRAF; // Don't allocate memory until needed when dragging\r\n\r\n  #adjustAlignment = false;\r\n\r\n  // Watchers\r\n  #checkPositionWatcher = false;\r\n  #checkBorderSizeWatcher = false;\r\n  #borderSizeObserver: ResizeObserver;\r\n  #resizeObserver: ResizeObserver;\r\n  #rtlWatcher: MutationObserver;\r\n\r\n  // Drag\r\n  #draggedDistanceX: number = 0;\r\n  #draggedDistanceY: number = 0;\r\n  #dragging = false;\r\n  #initialDragEvent: MouseEvent;\r\n  #lastDragEvent: MouseEvent;\r\n  #isRTLDirection: boolean;\r\n\r\n  // Resize\r\n  #currentEdge: ChPopoverResizeElement;\r\n  #draggedDistanceXForResize: number = 0;\r\n  #draggedDistanceYForResize: number = 0;\r\n  #maxBlockSize: number = 0;\r\n  #maxInlineSize: number = 0;\r\n  #minBlockSize: number = 0;\r\n  #minInlineSize: number = 0;\r\n  #resizeWasMade = false;\r\n\r\n  #resizeByDirectionDictionary = {\r\n    block: (popoverRect: DOMRect, direction: \"start\" | \"end\") => {\r\n      let currentDraggedDistanceY =\r\n        this.#lastDragEvent.clientY - this.#initialDragEvent.clientY;\r\n\r\n      // Start direction inverts the increment\r\n      if (direction === \"start\") {\r\n        currentDraggedDistanceY = -currentDraggedDistanceY;\r\n      }\r\n\r\n      const newBlockSize = popoverRect.height + currentDraggedDistanceY;\r\n      const newRestrictedBlockSize = forceCSSMinMax(\r\n        newBlockSize,\r\n        this.#minBlockSize,\r\n        this.#maxBlockSize\r\n      );\r\n\r\n      // Do not apply resizes or translations if the control is at the minimum\r\n      // or maximum size\r\n      if (newRestrictedBlockSize === popoverRect.height) {\r\n        return;\r\n      }\r\n\r\n      // - - - - - - - - - - - - - DOM write operations - - - - - - - - - - - - -\r\n      // By resizing the start edge the control is translated to improve the UX\r\n      if (direction === \"start\") {\r\n        this.#draggedDistanceYForResize -= currentDraggedDistanceY;\r\n\r\n        setProperty(\r\n          this.el,\r\n          POPOVER_DRAGGED_Y,\r\n          this.#draggedDistanceYForResize\r\n        );\r\n      }\r\n\r\n      setProperty(this.el, POPOVER_BLOCK_SIZE, newRestrictedBlockSize);\r\n    },\r\n\r\n    inline: (popoverRect: DOMRect, direction: \"start\" | \"end\") => {\r\n      let currentDraggedDistanceX =\r\n        this.#lastDragEvent.clientX - this.#initialDragEvent.clientX;\r\n\r\n      if (this.#isRTLDirection) {\r\n        currentDraggedDistanceX = -currentDraggedDistanceX;\r\n      }\r\n\r\n      // Start direction inverts the increment\r\n      if (direction === \"start\") {\r\n        currentDraggedDistanceX = -currentDraggedDistanceX;\r\n      }\r\n\r\n      const newInlineSize = popoverRect.width + currentDraggedDistanceX;\r\n      const newRestrictedInlineSize = forceCSSMinMax(\r\n        newInlineSize,\r\n        this.#minInlineSize,\r\n        this.#maxInlineSize\r\n      );\r\n\r\n      // Do not apply resizes or translations if the control is at the minimum\r\n      // or maximum size\r\n      if (newRestrictedInlineSize === popoverRect.width) {\r\n        return;\r\n      }\r\n\r\n      // - - - - - - - - - - - - - DOM write operations - - - - - - - - - - - - -\r\n      // By resizing the start edge the control is translated to improve the UX\r\n      if (direction === \"start\") {\r\n        this.#draggedDistanceXForResize -= currentDraggedDistanceX;\r\n\r\n        setProperty(\r\n          this.el,\r\n          POPOVER_DRAGGED_X,\r\n          this.#draggedDistanceXForResize\r\n        );\r\n      }\r\n\r\n      setProperty(this.el, POPOVER_INLINE_SIZE, newRestrictedInlineSize);\r\n    }\r\n  } as const;\r\n\r\n  #resizeEdgesAndCornersDictionary: {\r\n    [key in ChPopoverResizeElement]: (popoverRect: DOMRect) => void;\r\n  } = {\r\n    \"block-start\": popoverRect =>\r\n      this.#resizeByDirectionDictionary.block(popoverRect, \"start\"),\r\n\r\n    \"block-end\": popoverRect =>\r\n      this.#resizeByDirectionDictionary.block(popoverRect, \"end\"),\r\n\r\n    \"inline-start\": popoverRect =>\r\n      this.#resizeByDirectionDictionary.inline(popoverRect, \"start\"),\r\n\r\n    \"inline-end\": popoverRect =>\r\n      this.#resizeByDirectionDictionary.inline(popoverRect, \"end\"),\r\n\r\n    \"block-start-inline-start\": popoverRect => {\r\n      this.#resizeByDirectionDictionary.block(popoverRect, \"start\");\r\n      this.#resizeByDirectionDictionary.inline(popoverRect, \"start\");\r\n    },\r\n\r\n    \"block-start-inline-end\": popoverRect => {\r\n      this.#resizeByDirectionDictionary.block(popoverRect, \"start\");\r\n      this.#resizeByDirectionDictionary.inline(popoverRect, \"end\");\r\n    },\r\n\r\n    \"block-end-inline-start\": popoverRect => {\r\n      this.#resizeByDirectionDictionary.block(popoverRect, \"end\");\r\n      this.#resizeByDirectionDictionary.inline(popoverRect, \"start\");\r\n    },\r\n\r\n    \"block-end-inline-end\": popoverRect => {\r\n      this.#resizeByDirectionDictionary.block(popoverRect, \"end\");\r\n      this.#resizeByDirectionDictionary.inline(popoverRect, \"end\");\r\n    }\r\n  };\r\n\r\n  // Refs\r\n  #resizeLayer: HTMLDivElement;\r\n  #windowRef: Window;\r\n\r\n  @Element() el: HTMLChPopoverElement;\r\n\r\n  @State() resizing = false;\r\n\r\n  /**\r\n   * `true` if the `actionElement` binds the ch-popover using an external ID.\r\n   * If so, the `popoverTargetElement` property won't be configured in the\r\n   * action element.\r\n   */\r\n  @Prop() readonly actionById: boolean = false;\r\n\r\n  /**\r\n   * Specifies a reference of the action that controls the popover control.\r\n   */\r\n  @Prop() readonly actionElement?: PopoverActionElement;\r\n  @Watch(\"actionElement\")\r\n  handleActionChange(\r\n    newActionElement: PopoverActionElement,\r\n    oldActionElement: PopoverActionElement\r\n  ) {\r\n    // Reset dragged distance\r\n    this.#draggedDistanceX = 0;\r\n    this.#draggedDistanceY = 0;\r\n\r\n    // Remove previous action element\r\n    removePopoverTargetElement(oldActionElement);\r\n    addPopoverTargetElement(newActionElement, this.el, !this.actionById);\r\n\r\n    // Schedule update for watchers\r\n    this.#checkPositionWatcher = true;\r\n  }\r\n\r\n  /**\r\n   * Specifies the drag behavior of the popover.\r\n   * If `allowDrag === \"header\"`, a slot with the `\"header\"` name will be\r\n   * available to place the header content.\r\n   */\r\n  @Prop() readonly allowDrag: \"box\" | \"header\" | \"no\" = \"no\";\r\n\r\n  /**\r\n   * Specifies the block alignment of the window.\r\n   */\r\n  @Prop() readonly blockAlign: ChPopoverAlign = \"center\";\r\n  @Watch(\"blockAlign\")\r\n  handleBlockChange() {\r\n    this.#adjustAlignment = true;\r\n  }\r\n\r\n  /**\r\n   * Specifies how the popover adapts its block size.\r\n   *  - \"content\": The block size of the control will be determined by its\r\n   *    content block size.\r\n   *  - \"action-element\": The block size of the control will match the block\r\n   *    size of the `actionElement`.\r\n   *  - \"action-element-as-minimum\": The minimum block size of the control\r\n   *    will match the block size of the `actionElement`.\r\n   *\r\n   * If the control is resized at runtime, only the \"action-element-as-minimum\"\r\n   * value will still work.\r\n   */\r\n  @Prop() readonly blockSizeMatch: ChPopoverSizeMatch = \"content\";\r\n  @Watch(\"blockSizeMatch\")\r\n  blockSizeWatchChange(newValue: ChPopoverSizeMatch) {\r\n    if (this.#resizeWasMade) {\r\n      return;\r\n    }\r\n\r\n    // Remove the size constrains\r\n    if (newValue === \"content\") {\r\n      this.el.style.removeProperty(POPOVER_BLOCK_SIZE);\r\n      this.el.style.removeProperty(POPOVER_MIN_BLOCK_SIZE);\r\n    } else if (newValue === \"action-element\") {\r\n      this.el.style.removeProperty(POPOVER_MIN_BLOCK_SIZE);\r\n    } else {\r\n      this.el.style.removeProperty(POPOVER_BLOCK_SIZE);\r\n    }\r\n\r\n    // Queue a position adjustment\r\n    this.#adjustAlignment = true;\r\n  }\r\n\r\n  /**\r\n   * This property only applies for `\"manual\"` mode. In native popovers, when\r\n   * using `\"manual\"` mode the popover doesn't close when clicking outside the\r\n   * control. This property allows to close the popover when clicking outside\r\n   * in `\"manual\"` mode.\r\n   */\r\n  @Prop() readonly closeOnClickOutside: boolean = false;\r\n\r\n  /**\r\n   * `true` if the control is not stacked with another top layer.\r\n   */\r\n  @Prop() readonly firstLayer: boolean = true;\r\n\r\n  /**\r\n   * Specifies whether the popover is hidden or visible.\r\n   */\r\n  // eslint-disable-next-line @stencil-community/ban-default-true\r\n  @Prop({ mutable: true, reflect: true }) hidden = true;\r\n  @Watch(\"hidden\")\r\n  handleHiddenChange(newHiddenValue: boolean) {\r\n    // Schedule update for watchers\r\n    this.#checkBorderSizeWatcher = true;\r\n    this.#checkPositionWatcher = true;\r\n\r\n    // Update the popover visualization\r\n    if (newHiddenValue) {\r\n      if (this.firstLayer) {\r\n        this.#avoidFlickeringInTheNextRender(true);\r\n      }\r\n\r\n      this.el.hidePopover();\r\n    } else {\r\n      this.#showPopover();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Specifies the inline alignment of the window.\r\n   */\r\n  @Prop() readonly inlineAlign: ChPopoverAlign = \"center\";\r\n  @Watch(\"inlineAlign\")\r\n  handleInlineChange() {\r\n    this.#adjustAlignment = true;\r\n  }\r\n\r\n  /**\r\n   * Specifies how the popover adapts its inline size.\r\n   *  - \"content\": The inline size of the control will be determined by its\r\n   *    content inline size.\r\n   *  - \"action-element\": The inline size of the control will match the inline\r\n   *    size of the `actionElement`.\r\n   *  - \"action-element-as-minimum\": The minimum inline size of the control\r\n   *    will match the inline size of the `actionElement`.\r\n   *\r\n   * If the control is resized at runtime, only the \"action-element-as-minimum\"\r\n   * value will still work.\r\n   */\r\n  @Prop() readonly inlineSizeMatch: ChPopoverSizeMatch = \"content\";\r\n  @Watch(\"inlineSizeMatch\")\r\n  inlineSizeWatchChange(newValue: ChPopoverSizeMatch) {\r\n    if (this.#resizeWasMade) {\r\n      return;\r\n    }\r\n\r\n    // Remove the size constrains\r\n    if (newValue === \"content\") {\r\n      this.el.style.removeProperty(POPOVER_INLINE_SIZE);\r\n      this.el.style.removeProperty(POPOVER_MIN_INLINE_SIZE);\r\n    } else if (newValue === \"action-element\") {\r\n      this.el.style.removeProperty(POPOVER_MIN_INLINE_SIZE);\r\n    } else {\r\n      this.el.style.removeProperty(POPOVER_INLINE_SIZE);\r\n    }\r\n\r\n    // Queue a position adjustment\r\n    this.#adjustAlignment = true;\r\n  }\r\n\r\n  /**\r\n   * Popovers that have the `\"auto\"` state can be \"light dismissed\" by\r\n   * selecting outside the popover area, and generally only allow one popover\r\n   * to be displayed on-screen at a time. By contrast, `\"manual\"` popovers must\r\n   * always be explicitly hidden, but allow for use cases such as nested\r\n   * popovers in menus.\r\n   */\r\n  @Prop({ attribute: \"popover\" }) readonly mode: \"auto\" | \"manual\" = \"auto\";\r\n\r\n  /**\r\n   * Specifies an alternate position to try when the control overflows the\r\n   * window.\r\n   */\r\n  @Prop() readonly positionTry: \"flip-block\" | \"flip-inline\" | \"none\" = \"none\";\r\n\r\n  /**\r\n   * Specifies whether the control can be resized. If `true` the control can be\r\n   * resized at runtime by dragging the edges or corners.\r\n   */\r\n  @Prop() readonly resizable: boolean = false;\r\n  @Watch(\"resizable\")\r\n  resizableChanged() {\r\n    // Schedule update for border size watcher\r\n    this.#checkBorderSizeWatcher = true;\r\n  }\r\n\r\n  /**\r\n   * Emitted when the popover is opened.\r\n   */\r\n  @Event() popoverOpened: EventEmitter;\r\n\r\n  /**\r\n   * Emitted when the popover is closed.\r\n   */\r\n  @Event() popoverClosed: EventEmitter;\r\n\r\n  #showPopover = () => {\r\n    this.el.showPopover();\r\n    this.#addClickOutsideWatcherIfNecessary();\r\n  };\r\n\r\n  #handlePopoverCloseOnClickOutside = (event: MouseEvent) => {\r\n    if (!event.composedPath().includes(this.el)) {\r\n      this.#removeClickOutsideWatcher();\r\n\r\n      this.hidden = true;\r\n      this.popoverClosed.emit();\r\n    }\r\n  };\r\n\r\n  #addClickOutsideWatcherIfNecessary = () => {\r\n    if (this.mode === \"manual\" && this.closeOnClickOutside) {\r\n      document.addEventListener(\r\n        \"click\",\r\n        this.#handlePopoverCloseOnClickOutside,\r\n        // We should not add \"capture: true\" to let other elements interrupt\r\n        // this event in the capture phase\r\n        { passive: true }\r\n      );\r\n    }\r\n  };\r\n\r\n  #removeClickOutsideWatcher = () => {\r\n    document.removeEventListener(\r\n      \"click\",\r\n      this.#handlePopoverCloseOnClickOutside\r\n    );\r\n  };\r\n\r\n  #addDraggingClass = () => {\r\n    if (!this.#dragging) {\r\n      this.el.classList.add(DRAGGING_CLASS);\r\n      this.#dragging = true;\r\n    }\r\n  };\r\n\r\n  #removeDraggingClass = () => {\r\n    this.el.classList.remove(DRAGGING_CLASS);\r\n    this.#dragging = false;\r\n  };\r\n\r\n  #avoidFlickeringInTheNextRender = (addClass: boolean) => {\r\n    if (addClass) {\r\n      // Class to prevent flickering in the first position adjustment\r\n      this.el.classList.add(POPOVER_PREVENT_FLICKERING_CLASS);\r\n    } else {\r\n      this.el.classList.remove(POPOVER_PREVENT_FLICKERING_CLASS);\r\n    }\r\n  };\r\n\r\n  #setPositionWatcher = () => {\r\n    if (!this.actionElement || this.hidden) {\r\n      this.#removePositionWatcher();\r\n      return;\r\n    }\r\n\r\n    // If it was observing the previous container, disconnect the observer\r\n    if (this.#resizeObserver) {\r\n      this.#resizeObserver.disconnect();\r\n    }\r\n\r\n    this.#positionAdjustRAF ??= new SyncWithRAF();\r\n    this.#resizeObserver ??= new ResizeObserver(this.#updatePositionRAF);\r\n\r\n    this.#resizeObserver.observe(this.actionElement);\r\n    this.#resizeObserver.observe(this.el);\r\n\r\n    // Faster first render. Don't wait until the next animation frame\r\n    this.#updatePosition();\r\n\r\n    // The popover's position is now set, so we no longer have to hide it\r\n    if (this.firstLayer) {\r\n      requestAnimationFrame(() => {\r\n        this.#avoidFlickeringInTheNextRender(false);\r\n      });\r\n    }\r\n\r\n    // Listeners\r\n    this.#windowRef.addEventListener(\"resize\", this.#updatePositionRAF, {\r\n      passive: true\r\n    });\r\n    document.addEventListener(\"scroll\", this.#updatePositionRAF, {\r\n      capture: true,\r\n      passive: true\r\n    });\r\n  };\r\n\r\n  #updatePositionRAF = () => {\r\n    this.#positionAdjustRAF.perform(this.#updatePosition);\r\n  };\r\n\r\n  #updatePosition = () => {\r\n    // - - - - - - - - - - - - - DOM read operations - - - - - - - - - - - - -\r\n    const documentRect = document.documentElement.getBoundingClientRect();\r\n    const actionRect = this.actionElement.getBoundingClientRect();\r\n    const popoverRect = this.el.getBoundingClientRect();\r\n    const computedStyle = getComputedStyle(this.el);\r\n\r\n    const actionInlineStart = this.#getActionInlineStartPosition(\r\n      documentRect,\r\n      actionRect\r\n    );\r\n\r\n    this.#setResponsiveAlignment(\r\n      documentRect,\r\n      actionRect,\r\n      actionInlineStart,\r\n      popoverRect,\r\n      computedStyle\r\n    );\r\n\r\n    // - - - - - - - - - - - - - DOM write operations - - - - - - - - - - - - -\r\n    setProperty(this.el, POPOVER_ACTION_WIDTH, actionRect.width);\r\n    setProperty(this.el, POPOVER_ACTION_HEIGHT, actionRect.height);\r\n    setProperty(this.el, POPOVER_ACTION_LEFT, actionInlineStart);\r\n    setProperty(this.el, POPOVER_ACTION_TOP, actionRect.top);\r\n  };\r\n\r\n  #getActionInlineStartPosition = (\r\n    documentRect: DOMRect,\r\n    actionRect: DOMRect\r\n  ) =>\r\n    this.#isRTLDirection\r\n      ? documentRect.width - (actionRect.left + actionRect.width)\r\n      : actionRect.left;\r\n\r\n  #setResponsiveAlignment = (\r\n    documentRect: DOMRect,\r\n    actionRect: DOMRect,\r\n    actionInlineStart: number,\r\n    popoverRect: DOMRect,\r\n    computedStyle: CSSStyleDeclaration\r\n  ) => {\r\n    const popoverWidth = this.#getPopoverInlineSizeAndFixItIfNecessary(\r\n      actionRect,\r\n      popoverRect\r\n    );\r\n    const popoverHeight = this.#getPopoverBlockSizeAndFixItIfNecessary(\r\n      actionRect,\r\n      popoverRect\r\n    );\r\n\r\n    const alignment = setResponsiveAlignment(\r\n      documentRect,\r\n      actionRect,\r\n      actionInlineStart,\r\n      popoverWidth,\r\n      popoverHeight,\r\n      computedStyle,\r\n      this.inlineAlign,\r\n      this.blockAlign,\r\n      this.positionTry\r\n    );\r\n\r\n    // - - - - - - - - - - - - - DOM write operations - - - - - - - - - - - - -\r\n    setProperty(this.el, POPOVER_ALIGN_INLINE, alignment[0]);\r\n    setProperty(this.el, POPOVER_ALIGN_BLOCK, alignment[1]);\r\n  };\r\n\r\n  #getPopoverInlineSizeAndFixItIfNecessary = (\r\n    actionRect: DOMRect,\r\n    popoverRect: DOMRect\r\n  ) => {\r\n    if (this.inlineSizeMatch === \"action-element-as-minimum\") {\r\n      setProperty(this.el, POPOVER_MIN_INLINE_SIZE, actionRect.width);\r\n      return actionRect.width;\r\n    }\r\n\r\n    // Size is determined by the content\r\n    if (this.#resizeWasMade || this.inlineSizeMatch === \"content\") {\r\n      return popoverRect.width;\r\n    }\r\n\r\n    // Size is the same as the `actionElement`\r\n    setProperty(this.el, POPOVER_INLINE_SIZE, actionRect.width);\r\n    return actionRect.width;\r\n  };\r\n\r\n  #getPopoverBlockSizeAndFixItIfNecessary = (\r\n    actionRect: DOMRect,\r\n    popoverRect: DOMRect\r\n  ) => {\r\n    if (this.blockSizeMatch === \"action-element-as-minimum\") {\r\n      setProperty(this.el, POPOVER_MIN_BLOCK_SIZE, actionRect.height);\r\n      return actionRect.height;\r\n    }\r\n\r\n    // Size is determined by the content\r\n    if (this.#resizeWasMade || this.blockSizeMatch === \"content\") {\r\n      return popoverRect.height;\r\n    }\r\n\r\n    // Size is the same as the `actionElement`\r\n    setProperty(this.el, POPOVER_BLOCK_SIZE, actionRect.height);\r\n    return actionRect.height;\r\n  };\r\n\r\n  #removePositionWatcher = () => {\r\n    if (this.#resizeObserver) {\r\n      this.#resizeObserver.disconnect();\r\n      this.#resizeObserver = null; // Free the memory\r\n    }\r\n\r\n    // Remove listeners\r\n    this.#windowRef.removeEventListener(\"resize\", this.#updatePositionRAF);\r\n    document.removeEventListener(\"scroll\", this.#updatePositionRAF, {\r\n      capture: true\r\n    });\r\n  };\r\n\r\n  #handlePopoverToggle = (event: ToggleEvent) => {\r\n    const willBeHidden = !(event.newState === \"open\");\r\n    this.hidden = willBeHidden;\r\n\r\n    // Emit events only when the action is committed by the user\r\n    if (willBeHidden) {\r\n      this.popoverClosed.emit();\r\n    } else {\r\n      this.popoverOpened.emit();\r\n    }\r\n  };\r\n\r\n  // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\r\n  //                           Drag implementation\r\n  // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\r\n  #handleMouseDown = (event: MouseEvent) => {\r\n    // We should not add preventDefault in this instance, because we would\r\n    // prevent some normal actions like clicking a button or focusing an input\r\n\r\n    this.#dragRAF ||= new SyncWithRAF();\r\n    this.#initialDragEvent = event;\r\n\r\n    // Add listeners\r\n    document.addEventListener(\"mousemove\", this.#trackElementDragRAF, {\r\n      capture: true\r\n    });\r\n\r\n    document.addEventListener(\"mouseup\", this.#handleDragEnd, {\r\n      capture: true,\r\n      passive: true\r\n    });\r\n  };\r\n\r\n  #trackElementDragRAF = (event: MouseEvent) => {\r\n    this.#dragRAF.perform(this.#trackElementDrag, () => {\r\n      // Improve drag UX by not selecting any button or clicking interactive\r\n      // elements\r\n      event.preventDefault();\r\n\r\n      // We remove the pointer-events and user-select properties after the first\r\n      // \"mousemove\", otherwise double clicking to select text would not work\r\n      this.#addDraggingClass();\r\n\r\n      this.#lastDragEvent = event;\r\n    });\r\n  };\r\n\r\n  #trackElementDrag = () => {\r\n    // - - - - - - - - - - - - - DOM read operations - - - - - - - - - - - - -\r\n    const currentDraggedDistanceX =\r\n      this.#lastDragEvent.clientX - this.#initialDragEvent.clientX;\r\n    const currentDraggedDistanceY =\r\n      this.#lastDragEvent.clientY - this.#initialDragEvent.clientY;\r\n\r\n    // - - - - - - - - - - - - - DOM write operations - - - - - - - - - - - - -\r\n    // Update total dragged distance in X\r\n    if (currentDraggedDistanceX !== 0) {\r\n      this.#draggedDistanceX += this.#isRTLDirection // Set dragged distance depending on RTL value\r\n        ? -currentDraggedDistanceX\r\n        : currentDraggedDistanceX;\r\n      setProperty(this.el, POPOVER_DRAGGED_X, this.#draggedDistanceX);\r\n    }\r\n\r\n    // Update total dragged distance in Y\r\n    if (currentDraggedDistanceY !== 0) {\r\n      this.#draggedDistanceY += currentDraggedDistanceY;\r\n      setProperty(this.el, POPOVER_DRAGGED_Y, this.#draggedDistanceY);\r\n    }\r\n\r\n    // Update last point\r\n    this.#initialDragEvent = this.#lastDragEvent;\r\n  };\r\n\r\n  #handleDragEnd = () => {\r\n    // Cancel RAF to prevent access to undefined references\r\n    if (this.#dragRAF) {\r\n      this.#dragRAF.cancel();\r\n    }\r\n\r\n    // Remove listeners\r\n    document.removeEventListener(\"mousemove\", this.#trackElementDragRAF, {\r\n      capture: true\r\n    });\r\n\r\n    document.removeEventListener(\"mouseup\", this.#handleDragEnd, {\r\n      capture: true\r\n    });\r\n\r\n    this.#removeDraggingClass();\r\n\r\n    // Free the memory\r\n    this.#dragRAF = null;\r\n    this.#initialDragEvent = null;\r\n    this.#lastDragEvent = null;\r\n  };\r\n\r\n  // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\r\n  //                          Resize implementation\r\n  // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\r\n  #handleEdgeResize = (edge: ChPopoverResizeElement) => (event: MouseEvent) => {\r\n    this.resizing = true;\r\n    this.#resizeRAF ||= new SyncWithRAF();\r\n    this.#currentEdge = edge;\r\n    this.#initialDragEvent = event;\r\n\r\n    // Specify the cursor for the resize operation. Useful to avoid showing\r\n    // incorrect cursors during resizing\r\n    resizingCursorDictionary[this.#currentEdge](this.#isRTLDirection);\r\n\r\n    // Initialize drag variables to improve block-start and inline-start\r\n    // resizing. Otherwise, the popover will always remain in the same X and Y\r\n    // position, even when the block-start or inline-start edges are resized\r\n    this.#draggedDistanceXForResize = this.#draggedDistanceX;\r\n    this.#draggedDistanceYForResize = this.#draggedDistanceY;\r\n\r\n    // Get minimum and maximum sizes on first resize operation\r\n    const computedStyle = getComputedStyle(this.el);\r\n    this.#maxBlockSize = fromPxToNumber(computedStyle.maxBlockSize);\r\n    this.#maxInlineSize = fromPxToNumber(computedStyle.maxInlineSize);\r\n    this.#minBlockSize = fromPxToNumber(computedStyle.minBlockSize);\r\n    this.#minInlineSize = fromPxToNumber(computedStyle.minInlineSize);\r\n\r\n    // Avoid repositioning the popover\r\n    this.#removePositionWatcher();\r\n\r\n    // Avoid watching border changes during the resize\r\n    this.#removeBorderSizeWatcher();\r\n\r\n    // Avoid closing the popover during the resize\r\n    this.#removeClickOutsideWatcher();\r\n\r\n    // Add listeners\r\n    document.addEventListener(\"mousemove\", this.#trackElementResizeRAF, {\r\n      capture: true\r\n    });\r\n\r\n    document.addEventListener(\"mouseup\", this.#handleResizeEnd, {\r\n      capture: true,\r\n      passive: true\r\n    });\r\n  };\r\n\r\n  #trackElementResizeRAF = (event: MouseEvent) => {\r\n    this.#resizeRAF.perform(this.#trackElementResize, () => {\r\n      // Improve drag UX by not selecting any button or clicking interactive\r\n      // elements\r\n      event.preventDefault();\r\n\r\n      // We remove the pointer-events and user-select properties after the first\r\n      // \"mousemove\", otherwise double clicking to select text would not work\r\n      this.#addDraggingClass();\r\n\r\n      this.#lastDragEvent = event;\r\n    });\r\n  };\r\n\r\n  #trackElementResize = () => {\r\n    // - - - - - - - - - - - - - DOM read operations - - - - - - - - - - - - -\r\n    const popoverRect = this.el.getBoundingClientRect();\r\n\r\n    // - - - - - - - - - - - - - DOM write operations - - - - - - - - - - - - -\r\n    this.#resizeEdgesAndCornersDictionary[this.#currentEdge](popoverRect);\r\n    this.#resizeWasMade = true;\r\n\r\n    // Update last point\r\n    this.#initialDragEvent = this.#lastDragEvent;\r\n  };\r\n\r\n  #handleResizeEnd = () => {\r\n    this.resizing = false;\r\n\r\n    // Cancel RAF to prevent access to undefined references\r\n    if (this.#resizeRAF) {\r\n      this.#resizeRAF.cancel();\r\n    }\r\n\r\n    // Reset document cursor back to normal\r\n    document.body.style.cursor = null;\r\n\r\n    // Reset dragged distance to its original value\r\n    setProperty(this.el, POPOVER_DRAGGED_X, this.#draggedDistanceX);\r\n    setProperty(this.el, POPOVER_DRAGGED_Y, this.#draggedDistanceY);\r\n\r\n    // Update the position of the popover when the resize ends\r\n    this.#setPositionWatcher();\r\n\r\n    // Start again watching border size changes\r\n    this.#setBorderSizeWatcher();\r\n\r\n    // Add again the click outside watcher if necessary. RAF is needed to\r\n    // prevent the popover from closing, since the document click event will be\r\n    // dispatched after the execution of this function (mouseup handler)\r\n    requestAnimationFrame(this.#addClickOutsideWatcherIfNecessary);\r\n\r\n    // Remove listeners\r\n    document.removeEventListener(\"mousemove\", this.#trackElementResizeRAF, {\r\n      capture: true\r\n    });\r\n\r\n    document.removeEventListener(\"mouseup\", this.#handleResizeEnd, {\r\n      capture: true\r\n    });\r\n\r\n    this.#removeDraggingClass();\r\n\r\n    // Free the memory\r\n    this.#resizeRAF = null;\r\n    this.#initialDragEvent = null;\r\n    this.#lastDragEvent = null;\r\n  };\r\n\r\n  /**\r\n   * This observer watches the size of each border in the control to adjust the\r\n   * position of the invisible resize elements (edges and corners).\r\n   */\r\n  // eslint-disable-next-line @stencil-community/own-props-must-be-private\r\n  #setBorderSizeWatcher = () => {\r\n    if (!this.resizable || this.hidden) {\r\n      this.#removeBorderSizeWatcher();\r\n      return;\r\n    }\r\n\r\n    this.#borderSizeRAF ??= new SyncWithRAF();\r\n    this.#borderSizeObserver = new ResizeObserver(this.#updateBorderSizeRAF);\r\n\r\n    // Observe the size of the edges to know if the border\r\n    this.#borderSizeObserver.observe(this.el, { box: \"border-box\" });\r\n    this.#borderSizeObserver.observe(this.#resizeLayer);\r\n  };\r\n\r\n  #updateBorderSizeRAF = () => {\r\n    this.#borderSizeRAF.perform(this.#updateBorderSize);\r\n  };\r\n\r\n  #updateBorderSize = () => {\r\n    // - - - - - - - - - - - - - DOM read operations - - - - - - - - - - - - -\r\n    const computedStyle = getComputedStyle(this.el);\r\n\r\n    // - - - - - - - - - - - - - DOM write operations - - - - - - - - - - - - -\r\n    this.el.style.setProperty(\r\n      POPOVER_BORDER_BLOCK_START_SIZE,\r\n      computedStyle.borderBlockStartWidth\r\n    );\r\n\r\n    this.el.style.setProperty(\r\n      POPOVER_BORDER_BLOCK_END_SIZE,\r\n      computedStyle.borderBlockEndWidth\r\n    );\r\n\r\n    this.el.style.setProperty(\r\n      POPOVER_BORDER_INLINE_START_SIZE,\r\n      computedStyle.borderInlineStartWidth\r\n    );\r\n\r\n    this.el.style.setProperty(\r\n      POPOVER_BORDER_INLINE_END_SIZE,\r\n      computedStyle.borderInlineEndWidth\r\n    );\r\n  };\r\n\r\n  #removeBorderSizeWatcher = () => {\r\n    if (this.#borderSizeObserver) {\r\n      this.#borderSizeObserver.disconnect();\r\n      this.#borderSizeObserver = null; // Free the memory\r\n    }\r\n\r\n    this.#borderSizeRAF = null; // Free the memory\r\n  };\r\n\r\n  connectedCallback() {\r\n    this.#windowRef = window;\r\n\r\n    // Set RTL watcher\r\n    this.#rtlWatcher = new MutationObserver(() => {\r\n      this.#isRTLDirection = isRTL();\r\n\r\n      if (this.#isRTLDirection) {\r\n        this.el.style.setProperty(POPOVER_RTL, POPOVER_RTL_VALUE);\r\n        this.el.classList.add(POPOVER_RTL_CLASS);\r\n      } else {\r\n        this.el.style.removeProperty(POPOVER_RTL);\r\n        this.el.classList.remove(POPOVER_RTL_CLASS);\r\n      }\r\n    });\r\n\r\n    if (this.firstLayer) {\r\n      this.#avoidFlickeringInTheNextRender(true);\r\n    }\r\n\r\n    // Observe the dir attribute in the document\r\n    this.#rtlWatcher.observe(document.documentElement, {\r\n      attributeFilter: [\"dir\"]\r\n    });\r\n  }\r\n\r\n  componentWillRender() {\r\n    if (this.#checkPositionWatcher) {\r\n      this.#checkPositionWatcher = false;\r\n\r\n      // Update watchers\r\n      this.#setPositionWatcher();\r\n    }\r\n\r\n    if (this.#checkBorderSizeWatcher) {\r\n      this.#checkBorderSizeWatcher = false;\r\n\r\n      // Wait until the resize edges have been rendered\r\n      requestAnimationFrame(() => {\r\n        this.#setBorderSizeWatcher();\r\n      });\r\n    }\r\n\r\n    if (this.#adjustAlignment) {\r\n      const documentRect = document.documentElement.getBoundingClientRect();\r\n      const actionRect = this.actionElement.getBoundingClientRect();\r\n      const popoverRect = this.el.getBoundingClientRect();\r\n      const computedStyle = getComputedStyle(this.el);\r\n\r\n      const actionInlineStart = this.#getActionInlineStartPosition(\r\n        documentRect,\r\n        actionRect\r\n      );\r\n\r\n      this.#setResponsiveAlignment(\r\n        documentRect,\r\n        actionRect,\r\n        actionInlineStart,\r\n        popoverRect,\r\n        computedStyle\r\n      );\r\n    }\r\n  }\r\n\r\n  componentDidLoad() {\r\n    // Initialize popoverTargetElement\r\n    addPopoverTargetElement(this.actionElement, this.el, !this.actionById);\r\n\r\n    // Initialize watchers\r\n    this.#setPositionWatcher();\r\n    this.#setBorderSizeWatcher();\r\n\r\n    if (!this.hidden) {\r\n      this.#showPopover();\r\n    }\r\n  }\r\n\r\n  disconnectedCallback() {\r\n    this.#removePositionWatcher();\r\n    this.#removeBorderSizeWatcher();\r\n\r\n    // If the action element still exists, remove the reference\r\n    removePopoverTargetElement(this.actionElement);\r\n\r\n    // Defensive programming. Make sure the document does not have any unwanted handler\r\n    this.#handleDragEnd();\r\n\r\n    // Avoid leaving handlers in the document\r\n    this.#removeClickOutsideWatcher();\r\n\r\n    // Disconnect RTL watcher\r\n    if (this.#rtlWatcher) {\r\n      this.#rtlWatcher.disconnect();\r\n      this.#rtlWatcher = null; // Free the memory\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const canAddListeners = !this.hidden;\r\n\r\n    return (\r\n      <Host\r\n        class={{\r\n          \"gx-popover-header-drag\":\r\n            canAddListeners && this.allowDrag === \"header\",\r\n          [RESIZING_CLASS]: this.resizing\r\n        }}\r\n        popover={this.mode}\r\n        onMouseDown={\r\n          canAddListeners && this.allowDrag === \"box\"\r\n            ? this.#handleMouseDown\r\n            : null\r\n        }\r\n        onToggle={this.#handlePopoverToggle} // Check if the actionElement is an instance of Button to add this handler\r\n      >\r\n        {this.allowDrag === \"header\" && (\r\n          <div\r\n            class=\"header\"\r\n            part=\"header\"\r\n            onMouseDown={canAddListeners ? this.#handleMouseDown : null}\r\n          >\r\n            <slot name=\"header\" />\r\n          </div>\r\n        )}\r\n\r\n        <slot />\r\n\r\n        {this.resizable &&\r\n          !this.hidden && [\r\n            <div\r\n              class=\"edge__block-start\"\r\n              onMouseDown={this.#handleEdgeResize(\"block-start\")}\r\n            ></div>, // Top\r\n            <div\r\n              class=\"edge__inline-end\"\r\n              onMouseDown={this.#handleEdgeResize(\"inline-end\")}\r\n            ></div>, // Right\r\n            <div\r\n              class=\"edge__block-end\"\r\n              onMouseDown={this.#handleEdgeResize(\"block-end\")}\r\n            ></div>, // Bottom\r\n            <div\r\n              class=\"edge__inline-start\"\r\n              onMouseDown={this.#handleEdgeResize(\"inline-start\")}\r\n            ></div>, // Left\r\n\r\n            <div\r\n              class=\"corner__block-start-inline-start\"\r\n              onMouseDown={this.#handleEdgeResize(\"block-start-inline-start\")}\r\n            ></div>, // Top Left\r\n            <div\r\n              class=\"corner__block-start-inline-end\"\r\n              onMouseDown={this.#handleEdgeResize(\"block-start-inline-end\")}\r\n            ></div>, // Top Right\r\n            <div\r\n              class=\"corner__block-end-inline-start\"\r\n              onMouseDown={this.#handleEdgeResize(\"block-end-inline-start\")}\r\n            ></div>, // Bottom Left\r\n            <div\r\n              class=\"corner__block-end-inline-end\"\r\n              onMouseDown={this.#handleEdgeResize(\"block-end-inline-end\")}\r\n            ></div>, // Bottom Right\r\n\r\n            <div\r\n              class=\"resize-layer\"\r\n              ref={el => (this.#resizeLayer = el)}\r\n            ></div>\r\n          ]}\r\n      </Host>\r\n    );\r\n  }\r\n}\r\n"],"mappings":"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"}