{"version":3,"names":["DEFAULT_EXPAND_VALUE","observables","subscribers","addObservable","observableId","expanded","Map","set","removeObservable","delete","syncStateWithObservableAncestors","subscriberId","subscriberInfo","get","parentElement","getSubscriberRef","document","body","has","id","nextParentElement","parentNode","ShadowRoot","host","observerCallback","observableIsAncestor","subscriberRef","subscribe","removeSubscription","notifySubscribers","forEach"],"sources":["src/components/sidebar/expanded-change-obervables.ts"],"sourcesContent":["export type SubscriberInfo = {\r\n  getSubscriberRef: () => HTMLElement;\r\n  observerCallback: ObserverCallback;\r\n};\r\n\r\nexport type ObserverCallback = (expanded: boolean) => void;\r\n\r\nconst DEFAULT_EXPAND_VALUE = true;\r\n\r\nlet observables: Map<string, boolean> | undefined; // Don't allocate memory until needed\r\nlet subscribers: Map<string, SubscriberInfo> | undefined; // Don't allocate memory until needed\r\n\r\nexport const addObservable = (observableId: string, expanded: boolean) => {\r\n  observables ??= new Map();\r\n  observables.set(observableId, expanded);\r\n};\r\n\r\nexport const removeObservable = (observableId: string) => {\r\n  observables.delete(observableId);\r\n};\r\n\r\nexport const syncStateWithObservableAncestors = (subscriberId: string) => {\r\n  // There is not any observable\r\n  if (!observables) {\r\n    return;\r\n  }\r\n\r\n  const subscriberInfo = subscribers.get(subscriberId);\r\n\r\n  if (!subscriberInfo) {\r\n    return;\r\n  }\r\n\r\n  let parentElement: Element = subscriberInfo.getSubscriberRef();\r\n\r\n  // Travel all ancestors searching if there is an observable element\r\n  while (\r\n    parentElement !== document.body &&\r\n    !observables.has(parentElement.id)\r\n  ) {\r\n    let nextParentElement: Element = parentElement.parentElement;\r\n\r\n    // Check if the next parent element is a ShadowRoot\r\n    if (\r\n      nextParentElement === null &&\r\n      parentElement.parentNode instanceof ShadowRoot\r\n    ) {\r\n      nextParentElement = parentElement.parentNode.host;\r\n    }\r\n\r\n    parentElement = nextParentElement;\r\n  }\r\n\r\n  // Expanded by default\r\n  subscriberInfo.observerCallback(\r\n    observables.get(parentElement.id) ?? DEFAULT_EXPAND_VALUE\r\n  );\r\n};\r\n\r\nexport const observableIsAncestor = (\r\n  observableId: string,\r\n  subscriberRef: HTMLElement\r\n): boolean => {\r\n  let parentElement: Element = subscriberRef;\r\n\r\n  // Travel all ancestors searching if there is a element with the observableId\r\n  while (parentElement !== document.body && parentElement.id !== observableId) {\r\n    let nextParentElement: Element = parentElement.parentElement;\r\n\r\n    // Check if the next parent element is a ShadowRoot\r\n    if (\r\n      nextParentElement === null &&\r\n      parentElement.parentNode instanceof ShadowRoot\r\n    ) {\r\n      nextParentElement = parentElement.parentNode.host;\r\n    }\r\n\r\n    parentElement = nextParentElement;\r\n  }\r\n\r\n  return parentElement !== document.body;\r\n};\r\n\r\nexport const subscribe = (\r\n  subscriberId: string,\r\n  subscriberInfo: SubscriberInfo\r\n) => {\r\n  subscribers ??= new Map();\r\n  subscribers.set(subscriberId, subscriberInfo);\r\n};\r\n\r\nexport const removeSubscription = (subscriberId: string) => {\r\n  subscribers.delete(subscriberId);\r\n};\r\n\r\nexport const notifySubscribers = (observableId: string, expanded: boolean) => {\r\n  observables ??= new Map();\r\n\r\n  // Update the state in the \"observables\" Set\r\n  observables.set(observableId, expanded);\r\n\r\n  if (!subscribers) {\r\n    return;\r\n  }\r\n\r\n  // Notify all subscribers\r\n  subscribers.forEach(subscriberInfo => {\r\n    const subscriberRef = subscriberInfo.getSubscriberRef();\r\n\r\n    if (observableIsAncestor(observableId, subscriberRef)) {\r\n      subscriberInfo.observerCallback(expanded);\r\n    }\r\n  });\r\n};\r\n"],"mappings":"AAOA,MAAMA,EAAuB,KAE7B,IAAIC,EACJ,IAAIC,E,MAESC,EAAgB,CAACC,EAAsBC,KAClDJ,IAAgB,IAAIK,IACpBL,EAAYM,IAAIH,EAAcC,EAAS,E,MAG5BG,EAAoBJ,IAC/BH,EAAYQ,OAAOL,EAAa,E,MAGrBM,EAAoCC,IAE/C,IAAKV,EAAa,CAChB,M,CAGF,MAAMW,EAAiBV,EAAYW,IAAIF,GAEvC,IAAKC,EAAgB,CACnB,M,CAGF,IAAIE,EAAyBF,EAAeG,mBAG5C,MACED,IAAkBE,SAASC,OAC1BhB,EAAYiB,IAAIJ,EAAcK,IAC/B,CACA,IAAIC,EAA6BN,EAAcA,cAG/C,GACEM,IAAsB,MACtBN,EAAcO,sBAAsBC,WACpC,CACAF,EAAoBN,EAAcO,WAAWE,I,CAG/CT,EAAgBM,C,CAIlBR,EAAeY,iBACbvB,EAAYY,IAAIC,EAAcK,KAAOnB,EACtC,EAGI,MAAMyB,EAAuB,CAClCrB,EACAsB,KAEA,IAAIZ,EAAyBY,EAG7B,MAAOZ,IAAkBE,SAASC,MAAQH,EAAcK,KAAOf,EAAc,CAC3E,IAAIgB,EAA6BN,EAAcA,cAG/C,GACEM,IAAsB,MACtBN,EAAcO,sBAAsBC,WACpC,CACAF,EAAoBN,EAAcO,WAAWE,I,CAG/CT,EAAgBM,C,CAGlB,OAAON,IAAkBE,SAASC,IAAI,E,MAG3BU,EAAY,CACvBhB,EACAC,KAEAV,IAAgB,IAAII,IACpBJ,EAAYK,IAAII,EAAcC,EAAe,E,MAGlCgB,EAAsBjB,IACjCT,EAAYO,OAAOE,EAAa,E,MAGrBkB,EAAoB,CAACzB,EAAsBC,KACtDJ,IAAgB,IAAIK,IAGpBL,EAAYM,IAAIH,EAAcC,GAE9B,IAAKH,EAAa,CAChB,M,CAIFA,EAAY4B,SAAQlB,IAClB,MAAMc,EAAgBd,EAAeG,mBAErC,GAAIU,EAAqBrB,EAAcsB,GAAgB,CACrDd,EAAeY,iBAAiBnB,E,IAElC,S"}