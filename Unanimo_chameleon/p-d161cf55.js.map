{"version":3,"names":["URL_REGEX","computedStyle","normalizeUri","uri","startsWith","btoa","slice","replace","getImage","name","gxImageConstructor","getComputedStyle","document","documentElement","value","getPropertyValue","matches","gximage","match","densitySet","push","density","parseFloat","length","reduce","previousValue","currentValue","fromGxImageToURL","gxImage","Settings","undefined","url","id","baseUrl","WEBAPP_BASE","urlLower","toLowerCase","BASE_PATH","substring"],"sources":["src/components/tree-view/genexus-implementation.ts"],"sourcesContent":["import { TreeViewItemModel } from \"./types\";\r\n\r\nexport type GXRender<T extends true | false> = T extends true\r\n  ? TreeViewGXItemModel\r\n  : TreeViewItemModel;\r\n\r\nexport type TreeViewGXItemModel = Omit<\r\n  TreeViewItemModel,\r\n  \"disabled\" | \"dragDisabled\" | \"dropDisabled\"\r\n> & {\r\n  dragEnabled?: boolean;\r\n  dropEnabled?: boolean;\r\n  enabled?: boolean;\r\n};\r\n\r\nconst URL_REGEX = /url\\(([\"']?)([^\\)]*)\\)(?:\\s+([\\d.]+)x)?/i;\r\nlet computedStyle: CSSStyleDeclaration;\r\n\r\nfunction normalizeUri(uri: string): string {\r\n  if (uri.startsWith(\"data:image/svg+xml;utf8,\")) {\r\n    uri = `data:image/svg+xml;base64,${btoa(\r\n      uri.slice(24).replace(/\\\\\"/g, '\"')\r\n    )}`;\r\n  }\r\n\r\n  uri = uri.replace(/\\\\/g, \"\");\r\n  uri = uri.replace(/\\s/g, \"%20\");\r\n\r\n  return uri;\r\n}\r\n\r\nfunction getImage(\r\n  name: string,\r\n  gxImageConstructor: (name: string) => any\r\n): any {\r\n  computedStyle ||= getComputedStyle(document.documentElement);\r\n\r\n  let value = computedStyle.getPropertyValue(`--gx-image_${name}`);\r\n\r\n  if (value) {\r\n    let matches: RegExpMatchArray;\r\n    const gximage = gxImageConstructor(name);\r\n\r\n    while ((matches = value.match(URL_REGEX))) {\r\n      gximage.densitySet.push({\r\n        uri: normalizeUri(matches[1] ? matches[2].slice(0, -1) : matches[2]),\r\n        density: matches[3] ? parseFloat(matches[3]) : 1\r\n      });\r\n\r\n      value = value.slice(matches[0].length);\r\n    }\r\n\r\n    if (gximage.densitySet.length > 0) {\r\n      gximage.uri = gximage.densitySet.reduce((previousValue, currentValue) => {\r\n        return previousValue.density === 1 ||\r\n          previousValue.density < currentValue.density\r\n          ? previousValue\r\n          : currentValue;\r\n      }).uri;\r\n    }\r\n\r\n    return gximage;\r\n  }\r\n}\r\n\r\nexport const fromGxImageToURL = (\r\n  gxImage: any,\r\n  Settings: any,\r\n  gxImageConstructor: (name: string) => any\r\n): string | undefined => {\r\n  if (!gxImage) {\r\n    return undefined;\r\n  }\r\n\r\n  let url = \"\";\r\n  if (gxImage.id) {\r\n    url = getImage(gxImage.id, gxImageConstructor).uri;\r\n  } else {\r\n    url = gxImage.uri;\r\n  }\r\n\r\n  if (!url) {\r\n    return \"\";\r\n  }\r\n\r\n  const baseUrl = Settings.WEBAPP_BASE;\r\n  const urlLower = url.toLowerCase();\r\n  if (urlLower.startsWith(\"assets/\")) {\r\n    // Relative URL to local assets\r\n    return url;\r\n  }\r\n  if (\r\n    urlLower.startsWith(\"http://\") ||\r\n    urlLower.startsWith(\"https://\") ||\r\n    urlLower.startsWith(\"blob:\") ||\r\n    urlLower.startsWith(\"file:\") ||\r\n    urlLower.startsWith(\"data:\")\r\n  ) {\r\n    // Absolute URL\r\n    return url;\r\n  }\r\n  if (urlLower.startsWith(Settings.BASE_PATH.toLowerCase())) {\r\n    // Host relative URL\r\n    return baseUrl + url.substring(Settings.BASE_PATH.length);\r\n  }\r\n  return baseUrl + url;\r\n};\r\n"],"mappings":"AAeA,MAAMA,EAAY,2CAClB,IAAIC,EAEJ,SAASC,EAAaC,GACpB,GAAIA,EAAIC,WAAW,4BAA6B,CAC9CD,EAAM,6BAA6BE,KACjCF,EAAIG,MAAM,IAAIC,QAAQ,OAAQ,O,CAIlCJ,EAAMA,EAAII,QAAQ,MAAO,IACzBJ,EAAMA,EAAII,QAAQ,MAAO,OAEzB,OAAOJ,CACT,CAEA,SAASK,EACPC,EACAC,GAEAT,IAAkBU,iBAAiBC,SAASC,iBAE5C,IAAIC,EAAQb,EAAcc,iBAAiB,cAAcN,KAEzD,GAAIK,EAAO,CACT,IAAIE,EACJ,MAAMC,EAAUP,EAAmBD,GAEnC,MAAQO,EAAUF,EAAMI,MAAMlB,GAAa,CACzCiB,EAAQE,WAAWC,KAAK,CACtBjB,IAAKD,EAAac,EAAQ,GAAKA,EAAQ,GAAGV,MAAM,GAAI,GAAKU,EAAQ,IACjEK,QAASL,EAAQ,GAAKM,WAAWN,EAAQ,IAAM,IAGjDF,EAAQA,EAAMR,MAAMU,EAAQ,GAAGO,O,CAGjC,GAAIN,EAAQE,WAAWI,OAAS,EAAG,CACjCN,EAAQd,IAAMc,EAAQE,WAAWK,QAAO,CAACC,EAAeC,IAC/CD,EAAcJ,UAAY,GAC/BI,EAAcJ,QAAUK,EAAaL,QACnCI,EACAC,IACHvB,G,CAGL,OAAOc,C,CAEX,C,MAEaU,EAAmB,CAC9BC,EACAC,EACAnB,KAEA,IAAKkB,EAAS,CACZ,OAAOE,S,CAGT,IAAIC,EAAM,GACV,GAAIH,EAAQI,GAAI,CACdD,EAAMvB,EAASoB,EAAQI,GAAItB,GAAoBP,G,KAC1C,CACL4B,EAAMH,EAAQzB,G,CAGhB,IAAK4B,EAAK,CACR,MAAO,E,CAGT,MAAME,EAAUJ,EAASK,YACzB,MAAMC,EAAWJ,EAAIK,cACrB,GAAID,EAAS/B,WAAW,WAAY,CAElC,OAAO2B,C,CAET,GACEI,EAAS/B,WAAW,YACpB+B,EAAS/B,WAAW,aACpB+B,EAAS/B,WAAW,UACpB+B,EAAS/B,WAAW,UACpB+B,EAAS/B,WAAW,SACpB,CAEA,OAAO2B,C,CAET,GAAII,EAAS/B,WAAWyB,EAASQ,UAAUD,eAAgB,CAEzD,OAAOH,EAAUF,EAAIO,UAAUT,EAASQ,UAAUd,O,CAEpD,OAAOU,EAAUF,CAAG,S"}