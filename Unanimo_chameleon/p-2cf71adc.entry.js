import{r as t,c as i,h as e}from"./p-7af91c05.js";const s="ch-next-data-modeling-render{display:contents}";const d=s;const h=(t,i)=>{i.forEach((i=>{const e=i.Level;if(i.Type==="LEVEL"){t[i.DataType]=e.map((t=>t.Name));h(t,e)}}))};const n=t=>{if(!t){return{}}const i={};t.Entities.forEach((t=>{const e=t.Level;i[t.Name]=e.map((t=>t.Name));if(e){h(i,e)}}));return i};const a=class{constructor(e){t(this,e);this.fieldAdded=i(this,"fieldAdded",7);this.fieldRemoved=i(this,"fieldRemoved",7);this.addingModeCommonClass=undefined;this.captions={ATT:"Attribute",ENTITY:"Entity",LEVEL:"Collection",adding:"Adding...",addNewEntity:"Add new entity",addNewField:"Add new field",cancel:"Cancel",collection:"Collection",confirm:"Confirm",delete:"Delete",deleteMode:"Confirm delete?",deleting:"Deleting...",edit:"Edit",editing:"Saving...",newEntity:"New Entity",newField:"New Field"};this.commonClass=undefined;this.createGxCollectionCallback=undefined;this.cssClass=undefined;this.dataModel=undefined;this.dataModelToEdit=undefined;this.disabled=false;this.entityAddingModeClass=undefined;this.entityClass=undefined;this.errorTexts={Empty:"Field is empty.",AlreadyDefined1:"Field ",AlreadyDefinedEntity1:"Entity ",AlreadyDefined2:" already exists."};this.fieldAddingModeClass=undefined;this.fieldClass=undefined;this.fieldContainerClass=undefined;this.fieldCommonClass=undefined;this.hideLoading=null;this.maxAtts=3;this.readonly=false;this.subFieldClass=undefined;this.subFieldAddingModeClass=undefined;this.subFieldContainerClass=undefined}entityNameToATTs;entities=[];editedControl=null;entityWasAdded="none";handleDataModelChange(t){this.entityNameToATTs=n(t);this.entities=Object.keys(this.entityNameToATTs)}handleHideLoadingChange(){this.editedControl.hideWaitingMode();if(this.entityWasAdded==="adding"){this.entityWasAdded="finished";this.processEntityAdding()}}fieldAdded;fieldRemoved;addField=t=>i=>{this.addEntityItem(t,i.detail);this.updateReferences(i,true)};addEntityItem(t,i){const e={Name:i.name,Type:i.type,DataType:""};t.push(e)}deleteField=(t,i)=>e=>{t.remove(i+1);this.updateReferences(e)};editField=t=>i=>{t.Name=i.detail.name;t.Type=i.detail.type;t.DataType="";this.updateReferences(i,true)};addEntity=t=>i=>{this.entityWasAdded="adding";const e={Name:i.detail.name,Level:this.createGxCollectionCallback()};t.push(e);this.addEntityItem(e.Level,i.detail.level[0]);this.updateReferences(i,true)};editEntity=t=>i=>{t.Name=i.detail.name;this.updateReferences(i,true)};updateReferences(t,i=false){t.stopPropagation();this.editedControl=t.target;if(i){this.fieldAdded.emit()}else{this.fieldRemoved.emit()}this.processEntityAdding()}processEntityAdding(){if(!this.editedControl||this.entityWasAdded==="none"){return}const t=this.editedControl.classList;const i=this.editedControl.firstElementChild.classList;const e=this.editedControl.firstElementChild.firstElementChild.classList;if(this.entityWasAdded==="adding"){t.remove(this.addingModeCommonClass,this.entityAddingModeClass);t.add(this.entityClass,this.commonClass);i.add(this.fieldContainerClass);e.remove(this.addingModeCommonClass,...this.fieldAddingModeClass.split(" "));e.add(this.fieldClass,this.fieldCommonClass,this.commonClass);return}if(this.entityWasAdded==="finished"){t.remove(this.entityClass);t.add(this.addingModeCommonClass,this.entityAddingModeClass);i.remove(this.fieldContainerClass);e.remove(this.fieldClass);e.add(this.addingModeCommonClass,...this.fieldAddingModeClass.split(" "));this.entityWasAdded="none"}}componentWillLoad(){this.handleDataModelChange(this.dataModel)}render(){return e("ch-next-data-modeling",{key:"b45fe5053bce54f377ae65571513c00a28839b9a",class:this.cssClass},this.dataModel!=null&&this.dataModel.Entities!=null&&this.dataModel.Entities.map(((t,i)=>e("ch-next-data-modeling-item",{key:t.Name,captions:this.captions,class:this.entityClass+" "+this.commonClass,disabled:this.disabled,errorTexts:this.errorTexts,fieldNames:this.entities,name:t.Name,level:0,readonly:this.readonly,onDeleteField:!this.readonly?this.deleteField(this.dataModelToEdit?.Entities,i):null,onEditField:!this.readonly?this.editEntity(this.dataModelToEdit?.Entities[i]):null},e("ch-next-data-modeling",{class:this.fieldContainerClass},t.Level.map(((s,d)=>e("ch-next-data-modeling-item",{key:s.Name,captions:this.captions,class:this.fieldClass+" "+this.fieldCommonClass+" "+this.commonClass,dataType:s.DataType,disabled:this.disabled,entityNameToATTs:this.entityNameToATTs,errorTexts:this.errorTexts,fieldNames:this.entityNameToATTs[t.Name],maxAtts:this.maxAtts,name:s.Name,readonly:this.readonly,type:s.Type,onDeleteField:!this.readonly?this.deleteField(this.dataModelToEdit?.Entities[i].Level,d):null,onEditField:!this.readonly?this.editField(this.dataModelToEdit?.Entities[i].Level[d]):null},s.Level!=null&&s.Level.length>0&&e("ch-next-data-modeling",{class:this.subFieldContainerClass},s.Level.map(((t,h)=>e("ch-next-data-modeling-item",{key:t.Name,captions:this.captions,class:this.subFieldClass+" "+this.fieldCommonClass+" "+this.commonClass,dataType:t.DataType,disabled:this.disabled,entityNameToATTs:this.entityNameToATTs,errorTexts:this.errorTexts,fieldNames:this.entityNameToATTs[s.DataType],level:2,maxAtts:this.maxAtts,name:t.Name,readonly:this.readonly,type:t.Type,onDeleteField:!this.readonly?this.deleteField(this.dataModelToEdit?.Entities[i].Level[d].Level,h):null,onEditField:!this.readonly?this.editField(this.dataModelToEdit?.Entities[i].Level[d].Level[h]):null}))),!this.readonly&&e("ch-next-data-modeling-item",{key:"-1",captions:this.captions,class:this.subFieldAddingModeClass+" "+this.fieldCommonClass+" "+this.addingModeCommonClass+" "+this.commonClass,disabled:this.disabled,errorTexts:this.errorTexts,fieldNames:this.entityNameToATTs[s.DataType],level:2,mode:"add",type:"ATT",onNewField:this.addField(this.dataModelToEdit?.Entities[i].Level[d].Level)}))))),!this.readonly&&e("ch-next-data-modeling-item",{key:"-1",captions:this.captions,class:this.fieldAddingModeClass+" "+this.fieldCommonClass+" "+this.addingModeCommonClass+" "+this.commonClass,disabled:this.disabled,errorTexts:this.errorTexts,fieldNames:this.entityNameToATTs[t.Name],mode:"add",type:"ATT",onNewField:this.addField(this.dataModelToEdit?.Entities[i].Level)}))))),this.dataModel?.Entities&&!this.readonly&&e("ch-next-data-modeling-item",{key:"-1",captions:this.captions,class:this.entityAddingModeClass+" "+this.addingModeCommonClass+" "+this.commonClass,disabled:this.disabled,errorTexts:this.errorTexts,fieldNames:this.entities,level:0,mode:"add",onNewEntity:this.addEntity(this.dataModelToEdit?.Entities)},e("ch-next-data-modeling",{key:"8284d11c91f6c700a1a374b9edf8e5d50919eb54"},e("ch-next-data-modeling-item",{key:"86ebb645c9b8d8185127bd6d5cd896a2d02d5944",actionsVisible:false,captions:this.captions,class:this.fieldAddingModeClass+" "+this.fieldCommonClass+" "+this.addingModeCommonClass+" "+this.commonClass,disabled:this.disabled,errorTexts:this.errorTexts,mode:"add",showNewFieldBtn:false,type:"ATT"}))))}static get watchers(){return{dataModel:["handleDataModelChange"],hideLoading:["handleHideLoadingChange"]}}};a.style=d;export{a as ch_next_data_modeling_render};
//# sourceMappingURL=p-2cf71adc.entry.js.map