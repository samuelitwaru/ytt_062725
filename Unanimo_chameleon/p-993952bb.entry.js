import{r as t,h as s,H as e}from"./p-f2da1e38.js";var i;function n(t){t.ParentObject.refreshGrid(t.ControlName)}!function(t){t.FIRST="first",t.PREVIOUS="previous",t.NEXT="next",t.LAST="last"}(i||(i={}));class r{static load(t,s){var e;this.grid=t,this.state=null!=s?s:{},this.state.Columns=null!==(e=this.state.Columns)&&void 0!==e?e:[],this.apply()}static setColumnSort(t,s){this.state.SortColumnName=t,this.state.SortDirection=s}static setColumnHidden(t,s){this.getColumn(t).Hidden=s}static setColumnSize(t,s){this.getColumn(t).Size=s}static setColumnOrder(t,s){this.getColumn(t).Order=s}static setColumnFilterEqual(t,s){this.getColumnFilter(t).Equal=s,this.updateIsFiltering(t)}static setColumnFilterLess(t,s){this.getColumnFilter(t).Less=s,this.updateIsFiltering(t)}static setColumnFilterGreater(t,s){this.getColumnFilter(t).Greater=s,this.updateIsFiltering(t)}static apply(){var t,s;const e=this.grid.getColumnByHtmlName((null!==(t=this.state.SortColumnName)&&void 0!==t?t:"").toUpperCase());e&&(e.SortDirection=this.state.SortDirection),null===(s=this.state.Columns)||void 0===s||s.forEach(t=>{var s,e,i,n,r,l;const h=this.grid.getColumnByHtmlName(t.Name.toUpperCase());h&&(h.Hidden=t.Hidden?-1:0,h.filterEqual=null!==(e=(null!==(s=t.Filter)&&void 0!==s?s:{}).Equal)&&void 0!==e?e:h.filterEqual,h.filterLess=null!==(n=(null!==(i=t.Filter)&&void 0!==i?i:{}).Less)&&void 0!==n?n:h.filterLess,h.filterGreater=null!==(l=(null!==(r=t.Filter)&&void 0!==r?r:{}).Greater)&&void 0!==l?l:h.filterGreater,this.updateIsFiltering(h.htmlName))})}static getColumn(t){let s=this.state.Columns.find(s=>0==s.Name.localeCompare(t));return s||(s={Name:t},this.state.Columns.push(s)),s}static getColumnFilter(t){const s=this.getColumn(t);return s.Filter||(s.Filter={}),s.Filter}static updateIsFiltering(t){const s=this.grid.getColumnByHtmlName(t);s.isFiltering=!!(s.filterEqual||s.filterGreater||s.filterGreater)}}const l=class{constructor(s){t(this,s)}selectionChangedHandler(t){const s=this.getRowIndexByGxId(t.detail.rowsId[0]);s>=0&&(this.grid.execC2VFunctions(),this.grid.selectRow(s))}cellClickedHandler(t){const s=this.getRowIndexByGxId(t.detail.rowId),e=parseInt(t.detail.cellId);s>=0&&this.grid.executeEvent(e,s)}navigationClickedHandler(t){switch(t.detail.navigationType){case i.FIRST:(s=this.grid).OnPaginationFirst?s.OnPaginationFirst():s.usePaging&&s.changeGridPage("FIRST");break;case i.PREVIOUS:!function(t){t.OnPaginationPrevious?t.OnPaginationPrevious():t.usePaging&&t.changeGridPage("PREV")}(this.grid);break;case i.NEXT:!function(t){t.OnPaginationNext?t.OnPaginationNext():t.usePaging&&t.changeGridPage("NEXT")}(this.grid);break;case i.LAST:!function(t){t.OnPaginationLast?t.OnPaginationLast():t.usePaging&&t.changeGridPage("LAST")}(this.grid)}var s}refreshClickedHandler(){n(this.grid)}columnHiddenChangedHandler(t){r.setColumnHidden(t.detail.columnId,t.detail.hidden)}columnSizeChangedHandler(t){r.setColumnSize(t.detail.columnId,t.detail.size)}columnSortChangedHandler(t){switch(r.setColumnSort(t.detail.columnId,t.detail.sortDirection),this.grid.SortMode){case"client":!function(t,s,e){const i=t.getColumnByHtmlName(s);t.setSort(i.index,"desc"!=e)}(this.grid,t.detail.columnId,t.detail.sortDirection),this.gridTimestamp=Date.now();break;case"server":n(this.grid)}}columnOrderChangedHandler(t){r.setColumnOrder(t.detail.columnId,t.detail.order)}columnFilterChangedHandler(t){var s,e,i;const l=t.detail.column;l.filterEqual=null!==(s=t.detail.equal)&&void 0!==s?s:"",l.filterLess=null!==(e=t.detail.less)&&void 0!==e?e:"",l.filterGreater=null!==(i=t.detail.greater)&&void 0!==i?i:"",r.setColumnFilterEqual(l.htmlName,l.filterEqual),r.setColumnFilterLess(l.htmlName,l.filterLess),r.setColumnFilterGreater(l.htmlName,l.filterGreater),n(this.grid)}controlStateHandler(){this.loadState()}componentWillLoad(){this.loadState()}componentWillRender(){this.defineColumnRender()}componentDidLoad(){this.setCurrentRow(),this.notifyResizePopup()}render(){return s(e,null,s("ch-grid",{class:this.grid.Class,rowSelectionMode:this.grid.gxAllowSelection?"single":"none",rowSelectedClass:this.grid.RowSelectedClass.trim(),rowHighlightedClass:this.grid.RowHighlightedClass.trim()},this.grid.header&&this.renderTitle(),this.renderActionbar("header",this.grid.ActionbarHeaderClass),this.renderActionbar("footer",this.grid.ActionbarFooterClass),this.renderColumns(),this.renderRows(),this.grid.PaginatorShow&&this.grid.pageSize>0&&this.renderPaginator()))}renderTitle(){return s("h1",{slot:"header"},this.grid.header)}renderActionbar(t,e){const i=this.grid.ActionRefreshPosition==t,n=this.grid.ActionSettingsPosition==t;if(i||n)return s("ch-grid-actionbar",{slot:t,class:e},i&&this.renderActionRefresh(),n&&this.renderActionSettings())}renderActionRefresh(){return s("ch-grid-action-refresh",{class:this.grid.ActionRefreshClass,title:"title"==this.grid.ActionRefreshTextPosition?gx.getMessage("GX_BtnRefresh"):""},"text"==this.grid.ActionRefreshTextPosition?gx.getMessage("GX_BtnRefresh"):"")}renderActionSettings(){return s("ch-grid-action-settings",{class:this.grid.ActionSettingsClass,title:"title"==this.grid.ActionSettingsTextPosition?gx.getMessage("GXM_Settings"):""},"text"==this.grid.ActionSettingsTextPosition?gx.getMessage("GXM_Settings"):"")}renderColumns(){return s("ch-grid-columnset",{class:this.grid.ColumnsetClass},this.grid.columns.map(t=>{if(gx.lang.gxBoolean(t.render))return s("ch-grid-column",{key:t.htmlName,columnId:t.htmlName,columnIconUrl:t.Icon,columnName:t.title,columnNamePosition:t.NamePosition,size:this.getColumnSize(t),displayObserverClass:t.gxColumnClass,class:`${this.grid.ColumnClass} ${t.HeaderClass} ${t.isFiltering?"grid-column-filtering":""}`,hidden:-1==t.Hidden,hideable:-1==t.Hideable,resizable:-1==t.Resizeable,sortable:-1==t.Sortable,settingable:-1==t.Filterable,sortDirection:t.SortDirection},-1==t.Filterable&&this.renderColumnFilter(t))}))}renderColumnFilter(t){return s("gx-grid-chameleon-column-filter",{key:t.htmlName,class:this.grid.ColumnFilterClass,column:t,equal:t.filterEqual,less:t.filterLess,greater:t.filterGreater,buttonResetText:this.grid.FilterButtonResetText,buttonApplyText:this.grid.FilterButtonApplyText,slot:"settings"})}renderRows(){return this.grid.rows.map((t,e)=>s("ch-grid-row",{key:t.gxId,rowid:t.gxId,class:e%2==0?`${this.grid.RowClass} ${this.grid.RowEvenClass}`:`${this.grid.RowClass} ${this.grid.RowOddClass}`},this.renderCells(t)))}renderCells(t){return t.gxProps.map((t,e)=>{const i=this.grid.columns[e];if(gx.lang.gxBoolean(i.render))return s("ch-grid-cell",{key:t[0],class:this.grid.CellClass,cellid:e,innerHTML:this.renderControl(i.gxControl,t)})})}renderControl(t,s){return t.setProperties.apply(t,s),t.getHtml()}renderPaginator(){return s("ch-paginator",{class:this.grid.pagingBarClass,slot:"footer"},this.renderPaginatorNavigate(i.FIRST,this.grid.isFirstPage(),this.grid.pagingButtonFirstClass,gx.getMessage("GXM_first")),this.renderPaginatorNavigate(i.PREVIOUS,this.grid.isFirstPage(),this.grid.pagingButtonPreviousClass,gx.getMessage("GXM_previous")),this.renderPaginatorNavigate(i.NEXT,this.grid.isLastPage(),this.grid.pagingButtonNextClass,gx.getMessage("GXM_next")),this.renderPaginatorNavigate(i.LAST,this.grid.isLastPage(),this.grid.pagingButtonLastClass,gx.getMessage("GXM_last")))}renderPaginatorNavigate(t,e,i,n){const r=this.grid.PaginatorNavigationButtonTextPosition;return s("ch-paginator-navigate",{type:t,disabled:e,class:i,title:"title"==r?n:""},"text"==r?n:"")}getColumnSize(t){let s;switch(t.Size){case"auto":s="auto";break;case"css":s=`var(--${t.SizeVariableName}, min-content)`;break;case"length":s=t.SizeLength;break;case"max":s="max-content";break;case"min":s="min-content";break;case"minmax":s=`minmax(${t.SizeMinLength||"min-content"}, ${t.SizeMaxLength||"auto"})`;break;default:s="min-content"}return s||"min-content"}defineColumnRender(){const t=this.grid.properties;this.grid.columns.forEach((s,e)=>{s.render=0==t.length&&s.visible||t.some(t=>t[e].visible)})}getRowIndexByGxId(t){return this.grid.rows.findIndex(s=>s.gxId==t)}notifyResizePopup(){gx.popup.ispopup()&&gx.fx.obs.notify("gx.onafterevent")}setCurrentRow(){const t=this.grid.rows[0];t&&!gx.fn.currentGridRowImpl(this.grid.gxId)&&gx.fn.setCurrentGridRow(this.grid.gxId,t.gxId)}loadState(){r.load(this.grid,this.state)}static get watchers(){return{state:["controlStateHandler"]}}};l.style="gx-grid-chameleon{display:contents}";export{l as gx_grid_chameleon}