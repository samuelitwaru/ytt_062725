import{r as t,h as s,H as e}from"./p-7af91c05.js";function i(t){if(t.OnPaginationFirst){t.OnPaginationFirst()}else if(t.usePaging){t.changeGridPage("FIRST")}}function n(t){if(t.OnPaginationPrevious){t.OnPaginationPrevious()}else if(t.usePaging){t.changeGridPage("PREV")}}function r(t){if(t.OnPaginationNext){t.OnPaginationNext()}else if(t.usePaging){t.changeGridPage("NEXT")}}function h(t){if(t.OnPaginationLast){t.OnPaginationLast()}else if(t.usePaging){t.changeGridPage("LAST")}}function a(t,s){if(s===1){t.changeGridPage("FIRST")}else{t.eof=0;t.firstRecordOnPage=(t.pageSize*(s-1)-t.pageSize).toString();t.changeGridPage("NEXT")}}function o(t){t.ParentObject.refreshGrid(t.ControlName)}function c(t,s,e){const i=t.getColumnByHtmlName(s);t.setSort(i.index,e!=="desc")}class l{static grid;static state;static load(t,s){this.grid=t;this.state=s??{};this.state.Columns??=[];this.loadLocal();this.apply()}static setColumnSort(t,s){this.state.SortColumnName=t;this.state.SortDirection=s}static setColumnHidden(t,s){this.getColumn(t).Hidden=s;this.saveLocal()}static setColumnSize(t,s){this.getColumn(t).Size=s;this.saveLocal()}static setColumnFreeze(t,s){this.getColumn(t).Freeze=s;this.saveLocal()}static setColumnOrder(t,s){this.getColumn(t).Order=s;this.saveLocal()}static setColumnFilterEqual(t,s){this.getColumnFilter(t).Equal=s;this.updateIsFiltering(t)}static setColumnFilterLess(t,s){this.getColumnFilter(t).Less=s;this.updateIsFiltering(t)}static setColumnFilterGreater(t,s){this.getColumnFilter(t).Greater=s;this.updateIsFiltering(t)}static apply(){const t=this.grid.getColumnByHtmlName((this.state.SortColumnName??"").toUpperCase());if(t){t.SortDirection=this.state.SortDirection}this.state.Columns?.forEach((t=>{const s=this.grid.getColumnByHtmlName(t.Name.toUpperCase());if(s){if(typeof t.Hidden==="boolean"){s.Hidden=t.Hidden?-1:0}if(t.Size){s.Size="length";s.SizeLength=t.Size}if(t.Order){s.order=t.Order}s.filterEqual=(t.Filter??{}).Equal??s.filterEqual;s.filterLess=(t.Filter??{}).Less??s.filterLess;s.filterGreater=(t.Filter??{}).Greater??s.filterGreater;this.updateIsFiltering(s.htmlName)}}))}static loadLocal(){this.grid.columns.forEach((t=>{const s=localStorage.getItem(`${this.grid.ControlName}-${t.htmlName}`)?.split("|");if(s){if(s[0]!==""){this.getColumn(t.htmlName).Hidden=s[0]==="true"}if(s[1]!==""){this.getColumn(t.htmlName).Size=s[1]}if(s[2]!==""){this.getColumn(t.htmlName).Order=parseInt(s[2])}if(s[3]!==""){this.getColumn(t.htmlName).Freeze=s[3]}}}))}static saveLocal(){this.state.Columns.forEach((t=>{localStorage.setItem(`${this.grid.ControlName}-${t.Name}`,[t.Hidden,t.Size,t.Order,t.Freeze].join("|"))}))}static getColumn(t){let s=this.state.Columns.find((s=>s.Name.localeCompare(t)===0));if(!s){s={Name:t};this.state.Columns.push(s)}return s}static getColumnFilter(t){const s=this.getColumn(t);s.Filter||={};return s.Filter}static updateIsFiltering(t){const s=this.grid.getColumnByHtmlName(t);s.isFiltering=!!(s.filterEqual||s.filterGreater||s.filterGreater)}}const d="gx-grid-chameleon{display:contents}";const u=d;const g=class{constructor(s){t(this,s);this.grid=undefined;this.gridTimestamp=undefined;this.state=undefined}controlStateHandler(){this.loadState()}componentWillLoad(){this.loadState()}componentWillRender(){this.defineColumnRender()}componentDidLoad(){this.setCurrentRow();this.notifyResizePopup()}selectionChangedHandler(t){const s=this.getRowIndexByGxId(t.detail.rowsId[0]);if(s>=0){this.grid.execC2VFunctions();this.grid.selectRow(s)}}cellClickedHandler(t){const s=this.getRowIndexByGxId(t.detail.rowId);const e=parseInt(t.detail.cellId);if(s>=0){this.grid.executeEvent(e,s)}}navigateClickedHandler(t){switch(t.detail.type){case"first":i(this.grid);break;case"previous":n(this.grid);break;case"next":r(this.grid);break;case"last":h(this.grid);break;case"goto":a(this.grid,t.detail.page);break}}refreshClickedHandler(){o(this.grid)}columnHiddenChangedHandler(t){l.setColumnHidden(t.detail.columnId,t.detail.hidden)}columnSizeChangedHandler(t){l.setColumnSize(t.detail.columnId,t.detail.size)}columnFreezeChangedHandler(t){l.setColumnFreeze(t.detail.columnId,t.detail.freeze)}columnSortChangedHandler(t){l.setColumnSort(t.detail.columnId,t.detail.sortDirection);switch(this.grid.SortMode){case"client":c(this.grid,t.detail.columnId,t.detail.sortDirection);this.gridTimestamp=Date.now();break;case"server":o(this.grid);break}}columnOrderChangedHandler(t){l.setColumnOrder(t.detail.columnId,t.detail.order)}columnFilterChangedHandler(t){const s=t.detail.column;s.filterEqual=t.detail.equal??"";s.filterLess=t.detail.less??"";s.filterGreater=t.detail.greater??"";l.setColumnFilterEqual(s.htmlName,s.filterEqual);l.setColumnFilterLess(s.htmlName,s.filterLess);l.setColumnFilterGreater(s.htmlName,s.filterGreater);o(this.grid)}getColumnSize(t){let s;switch(t.Size){case"auto":s="auto";break;case"css":s=`var(--${t.SizeVariableName}, min-content)`;break;case"length":s=t.SizeLength;break;case"max":s="max-content";break;case"min":s="min-content";break;case"minmax":s=`minmax(${t.SizeMinLength||"min-content"}, ${t.SizeMaxLength||"auto"})`;break;default:s="min-content";break}return s||"min-content"}defineColumnRender(){const t=this.grid.properties;this.grid.columns.forEach(((s,e)=>{s.render=t.length===0&&s.visible||t.some((t=>t[e].visible))}))}getRowIndexByGxId(t){return this.grid.rows.findIndex((s=>s.gxId===t))}notifyResizePopup(){if(gx.popup.ispopup()){gx.fx.obs.notify("gx.onafterevent")}}setCurrentRow(){const t=this.grid.rows[0];if(t&&!gx.fn.currentGridRowImpl(this.grid.gxId)){gx.fn.setCurrentGridRow(this.grid.gxId,t.gxId)}}loadState(){l.load(this.grid,this.state)}renderTitle(){return s("h1",{slot:"header"},this.grid.header)}renderActionbar(t,e){const i=this.grid.ActionRefreshPosition===t,n=this.grid.ActionSettingsPosition===t;if(i||n){return s("ch-grid-actionbar",{slot:t,class:e},i&&this.renderActionRefresh(),n&&this.renderActionSettings())}}renderActionRefresh(){return s("ch-grid-action-refresh",{class:this.grid.ActionRefreshClass,title:this.grid.ActionRefreshTextPosition==="title"?gx.getMessage("GX_BtnRefresh"):""},this.grid.ActionRefreshTextPosition==="text"?gx.getMessage("GX_BtnRefresh"):"")}renderActionSettings(){return s("ch-grid-action-settings",{class:this.grid.ActionSettingsClass,title:this.grid.ActionSettingsTextPosition==="title"?gx.getMessage("GXM_Settings"):""},this.grid.ActionSettingsTextPosition==="text"?gx.getMessage("GXM_Settings"):"")}renderColumns(){return s("ch-grid-columnset",{class:this.grid.ColumnsetClass},this.grid.columns.map((t=>{if(gx.lang.gxBoolean(t.render)){return s("ch-grid-column",{key:t.htmlName,columnId:t.htmlName,columnIconUrl:t.Icon,columnName:t.title,columnNamePosition:t.NamePosition,size:this.getColumnSize(t),order:t.order?t.order:null,displayObserverClass:t.gxColumnClass,class:`${this.grid.ColumnClass} ${t.HeaderClass} ${t.isFiltering?"grid-column-filtering":""}`,hidden:t.Hidden===-1,hideable:t.Hideable===-1,resizable:t.Resizeable===-1,sortable:t.Sortable===-1,settingable:t.Filterable===-1,sortDirection:t.SortDirection},t.Filterable===-1&&this.renderColumnFilter(t))}})))}renderColumnFilter(t){return s("gx-grid-chameleon-column-filter",{key:t.htmlName,class:this.grid.ColumnFilterClass,column:t,equal:t.filterEqual,less:t.filterLess,greater:t.filterGreater,buttonResetText:this.grid.FilterButtonResetText,buttonApplyText:this.grid.FilterButtonApplyText,slot:"settings"})}renderRows(){return this.grid.rows.map(((t,e)=>{const i=`${this.grid.RowClass} ${this.grid.RowEvenClass}`;const n=`${this.grid.RowClass} ${this.grid.RowOddClass}`;return s("ch-grid-row",{key:t.gxId,rowid:t.gxId,class:e%2===0?i:n},this.renderCells(t))}))}renderCells(t){return t.gxProps.map(((t,e)=>{const i=this.grid.columns[e];if(gx.lang.gxBoolean(i.render)){return s("ch-grid-cell",{key:t[0],class:this.grid.CellClass,cellid:e,innerHTML:this.renderControl(i.gxControl,t)})}}))}renderControl(t,s){t.setProperties.apply(t,s);return t.getHtml()}renderPaginator(){const t=!!this.grid.ParentObject[`sub${this.grid.ControlName}_Recordcount`];const e=this.grid.ParentObject[`sub${this.grid.ControlName}_Recordcount`]??0;const i=!this.grid.isLastPage();const n=Math.ceil((parseInt(this.grid.firstRecordOnPage)+1)/this.grid.pageSize);const r=Math.max(1,Math.ceil(e/this.grid.pageSize));return s("ch-paginator",{"has-next-page":t?null:i,"active-page":n,"total-pages":t?r:-1,class:this.grid.pagingBarClass,slot:"footer"},this.renderPaginatorNavigate("first",this.grid.pagingButtonFirstClass,gx.getMessage("GXM_first")),this.renderPaginatorNavigate("previous",this.grid.pagingButtonPreviousClass,gx.getMessage("GXM_previous")),this.grid.PaginatorPagesShow&&s("ch-paginator-pages",{maxSize:this.grid.PaginatorPagesMaxSize}),this.renderPaginatorNavigate("next",this.grid.pagingButtonNextClass,gx.getMessage("GXM_next")),this.renderPaginatorNavigate("last",this.grid.pagingButtonLastClass,gx.getMessage("GXM_last")))}renderPaginatorNavigate(t,e,i){const n=this.grid.PaginatorNavigationButtonTextPosition;return s("ch-paginator-navigate",{type:t,class:e,title:n==="title"?i:""},n==="text"?i:"")}renderPaginationInfo(){const t=this.grid.ParentObject[`sub${this.grid.ControlName}_Recordcount`]??0;let e=this.grid.PaginatorInfoEmptyTextMask;let i=0;let n=0;if(t>0){e=this.grid.PaginatorInfoTextMask;i=parseInt(this.grid.firstRecordOnPage)+1;n=Math.min(i+this.grid.pageSize-1,t)}const r={"record-count":t,"record-start":i,"record-end":n};const h=e.replace(/\{([^}]+)\}/g,((t,s)=>r[s]??s));return s("div",{class:this.grid.PaginatorInfoClass,slot:"footer"},h)}render(){return s(e,{key:"8a4af56b1528d70f5f02a9fb23ca56b12aec049d"},s("ch-grid",{key:"745190f47349786fd70d2c68b23754e29a916ed1",class:this.grid.Class,rowSelectionMode:this.grid.gxAllowSelection?"single":"none",rowSelectedClass:this.grid.RowSelectedClass.trim(),rowHighlightedClass:this.grid.RowHighlightedClass.trim()},this.grid.header&&this.renderTitle(),this.renderActionbar("header",this.grid.ActionbarHeaderClass),this.renderActionbar("footer",this.grid.ActionbarFooterClass),this.renderColumns(),this.renderRows(),this.grid.PaginatorShow&&this.grid.PaginatorInfoShow&&this.grid.pageSize>0&&this.renderPaginationInfo(),this.grid.PaginatorShow&&this.grid.pageSize>0&&this.renderPaginator()))}static get watchers(){return{state:["controlStateHandler"]}}};g.style=u;export{g as gx_grid_chameleon};
//# sourceMappingURL=p-3f7108c3.entry.js.map