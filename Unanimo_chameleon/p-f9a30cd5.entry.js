import{r as t,c as e,g as s,f as n,h as i,H as o}from"./p-7af91c05.js";import{e as r,R as a,b as l}from"./p-0978aac4.js";import{t as c}from"./p-fdd5c42c.js";import{r as d}from"./p-23a9d308.js";const h="--ch-flexible-layout-drop-area-block-start";const u="--ch-flexible-layout-drop-area-block-end";const f="--ch-flexible-layout-drop-area-inline-start";const p="--ch-flexible-layout-drop-area-inline-end";const m=30;const g=100-m;const b=.5;const x=(t,e,s)=>t.style.setProperty(e,`${s}px`);const w=(t,e)=>e?t.left+t.width*b:t.left;const y=(t,e,s)=>s?t.width-e.right:t.width-(e.left+e.width*b);const I={"block-start":(t,e)=>[e.top,t.height-(e.top+e.height*b),e.left,t.width-e.right],"block-end":(t,e)=>[e.top+e.height*b,t.height-(e.top+e.height),e.left,t.width-e.right],"inline-start":(t,e,s)=>[e.top,t.height-(e.top+e.height),w(e,s),y(t,e,s)],"inline-end":(t,e,s)=>[e.top,t.height-(e.top+e.height),w(e,!s),y(t,e,!s)],center:(t,e)=>[e.top,t.height-(e.top+e.height),e.left,t.width-e.right]};let v;let k;const C=(t,e,s)=>n=>{n.stopPropagation();const i=document.documentElement.getBoundingClientRect();const o=t.mainView.getBoundingClientRect();const a=n.clientX;const l=n.clientY;const c=s?o.width-(a-o.left):a-o.left;const d=l-o.top;const b=c/o.width*100;const w=d/o.height*100;let y;if(w<=m&&r(w,b,100-w)){y="block-start"}else if(b>=g&&r(100-b,w,b)){y="inline-end"}else if(b<=m&&r(b,w,100-b)){y="inline-start"}else if(w>=g&&r(100-w,b,w)){y="block-end"}else{y="center"}if(k===t.viewId&&v===y){return}v=y;k=t.viewId;const C=I[y](i,o,s);x(e,h,C[0]);x(e,u,C[1]);x(e,f,C[2]);x(e,p,C[3])};const S=t=>{v=undefined;k=undefined;t.removeAttribute("style")};const V=()=>v===undefined?undefined:{dropAreaTarget:v,viewIdTarget:k};const W=(t,e,s)=>{const n=t.id;const i=t.type;if(i==="single-content"){const o=t.widget;e.add(o.id);s.set(n,{parentLeafId:n,info:o});return{id:n,type:i,exportParts:"",widget:o}}let o=t.selectedWidgetId;const r=t.widgets;const a=t.tabDirection;const l=t.tabPosition;const d=c[`${a}-${l??"start"}`](r);r.forEach((t=>{if(t.wasRendered||o===t.id){t.wasRendered=true;e.add(t.id)}s.set(t.id,{parentLeafId:n,info:t})}));if(o==null){const t=r[a==="block"?r.length-1:0];o=t.id;t.wasRendered=true;e.add(o)}return{id:n,exportParts:d,closeButtonHidden:t.closeButtonHidden??false,dragOutsideDisabled:t.dragOutsideDisabled??false,selectedWidgetId:o,showCaptions:t.showCaptions??true,sortable:t.sortable??true,tabDirection:a,tabPosition:t.tabPosition,type:i,widgets:r}};const L=(t,e)=>{if(t.dragBar?.part){e.add(t.dragBar?.part)}};const R=(t,e,s,n,i)=>{const o={item:t,parentItem:e,leafInfo:W(t,n,i)};s.set(t.id,o)};const D=(t,e,s,n,i,o)=>{t.forEach((t=>{if(t.items!=null){const r=t;const a={item:r,parentItem:o};e.set(r.id,a);s.add(r.id);D(r.items,e,s,n,i,r)}else{R(t,o,e,n,i)}L(t,s)}))};const $=(t,e,s,n,i)=>D(t.items,e,s,n,i,a);const P=(t,e)=>t.get(e).leafInfo;const A=":host{display:contents}.droppable-area{width:auto;height:auto;padding:0;margin:0;border:unset;color:unset;inset-block:var(--ch-flexible-layout-drop-area-block-start) var(--ch-flexible-layout-drop-area-block-end);left:var(--ch-flexible-layout-drop-area-inline-start);right:var(--ch-flexible-layout-drop-area-inline-end);background-color:color-mix(in srgb, currentColor 15%, transparent);-webkit-transition:inset 150ms ease-in-out;transition:inset 150ms ease-in-out;pointer-events:none}.ch-list-inline--end{grid-template-columns:1fr -webkit-max-content;grid-template-columns:1fr max-content}.ch-list-block--end{grid-template-rows:1fr -webkit-max-content;grid-template-rows:1fr max-content}.ch-list-inline--end::part(tab-list),.ch-list-block--end::part(tab-list){-ms-flex-order:1;order:1}";const M=A;const _=t=>`[id="${t}"]`;const j="Escape";const B=class{constructor(s){t(this,s);this.viewItemClose=e(this,"viewItemClose",7);this.selectedViewItemChange=e(this,"selectedViewItemChange",7);this.viewItemReorder=e(this,"viewItemReorder",7);this.dragBarDisabled=false;this.itemsInfo=undefined;this.layoutSplitterParts=undefined;this.model=undefined}#t;#e;#s;#n;#i;#o;get el(){return s(this)}viewItemClose;selectedViewItemChange;viewItemReorder;async addSiblingView(t,e,s,i,o){const r=await this.#o.addSiblingLeaf(t,e,s,i,o);if(r.success){n(this)}return r.success}async refreshLeaf(t){const e=this.el.shadowRoot.querySelector(_(t));if(!e){return}n(e)}async removeView(t){const e=await this.#o.removeItem(t);if(e.success){n(this)}return{success:e.success,reconnectedSubtree:e.reconnectedSubtree}}async removeItemPageInView(t,e,s=true){const n=this.#r(t);if(!n){return}const i=this.el.shadowRoot.querySelector(`ch-list[id='${n.id}']`);await i.removePage(e,s)}#r=t=>P(this.itemsInfo,t);#a=()=>{const t=[];this.itemsInfo.forEach((e=>{const s=e.leafInfo;if(s!=null){t.push(s)}}));return t};handleItemChange=t=>e=>{e.stopPropagation();const s={...e.detail,viewId:t};this.selectedViewItemChange.emit(s)};handleItemClose=t=>e=>{e.stopPropagation();const s={...e.detail,viewId:t};this.viewItemClose.emit(s)};handleDragStart=t=>async e=>{e.stopPropagation();this.#n=e.target;const s=[...this.el.shadowRoot.querySelectorAll("ch-list")];this.#e={index:e.detail,viewId:t};const n=await Promise.allSettled(s.map((t=>t.getDraggableViews())));this.#t=[];n.forEach(((t,e)=>{if(t.status==="fulfilled"){const n=t.value;const i=new AbortController;const o={...n,viewId:s[e].id,abortController:i};this.#t.push(o);const r=l();n.mainView.addEventListener("mousemove",C(o,this.#i,r),{capture:true,passive:true,signal:i.signal});o.tabListView.style.pointerEvents="none";o.pageView.style.pointerEvents="none"}}));document.addEventListener("mouseup",this.#l,{passive:true});document.addEventListener("keydown",this.#c,{passive:true});this.#s=new AbortController;document.addEventListener("mousemove",(()=>S(this.#i)),{passive:true,signal:this.#s.signal});this.#i.showPopover();this.#n.promoteDragPreviewToTopLayer();this.dragBarDisabled=true};#c=t=>{if(t.code!==j){return}t.preventDefault();S(this.#i);this.#l();this.#n.endDragPreview()};#l=()=>{this.#t.forEach((t=>{t.abortController.abort();t.tabListView.style.pointerEvents=null;t.pageView.style.pointerEvents=null}));document.removeEventListener("mouseup",this.#l);document.removeEventListener("keydown",this.#c);this.#s.abort();const t=V();if(t){this.viewItemReorder.emit({...this.#e,...t})}this.#i.hidePopover();S(this.#i);this.#t=undefined;this.#e=undefined;this.dragBarDisabled=false};renderTab=t=>i("ch-list",{id:t.id,key:t.id,slot:t.id,class:{[`ch-list-${t.tabDirection}--end`]:t.tabPosition==="end"},part:`leaf ${t.tabDirection} ${t.tabPosition??"start"} ${t.id}`,exportparts:t.exportParts,closeButtonHidden:t.closeButtonHidden,dragOutsideDisabled:t.dragOutsideDisabled,direction:t.tabDirection,model:t.widgets,selectedId:t.selectedWidgetId,showCaptions:t.showCaptions,sortable:t.sortable,onItemClose:this.handleItemClose(t.id),onItemDragStart:this.handleDragStart(t.id),onSelectedItemChange:this.handleItemChange(t.id)},t.widgets.map((t=>t.wasRendered&&i("slot",{name:t.id,slot:t.id}))));renderView=t=>t.type==="single-content"?i("slot",{key:t.id,slot:t.id,name:t.id}):this.renderTab(t);render(){const t=this.model;if(t==null){return""}return i(o,null,i("ch-layout-splitter",{dragBarDisabled:this.dragBarDisabled,model:t,exportparts:"bar,"+this.layoutSplitterParts,ref:t=>this.#o=t},this.#a().map(this.renderView)),i("div",{"aria-hidden":"true",class:"droppable-area",part:"droppable-area",popover:"manual",ref:t=>this.#i=t}))}};B.style=M;const O="ch-flexible-layout-render,.ch-flexible-layout-render-slot{display:contents}";const T=O;const E=()=>{let t=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{let s=Math.random()*16;s=(t+s)%16|0;t=Math.floor(t/16);return(e==="x"?s:s&3|8).toString(16)}))};const H=class{constructor(e){t(this,e);this.cssClass="flexible-layout";this.model=undefined;this.renders=undefined}#d=new Set;#h=new Map;#u=new Map;#f="";#p;modelChanged(t){this.#m(t)}async addSiblingView(t,e,s,i,o){const r=await this.#p.addSiblingView(t,e,s,i,o);if(!r){return false}R(i,this.#u.get(t).item,this.#u,this.#d,this.#h);n(this);return true}async addWidget(t,e,s=true){const i=this.#u.get(t);if(!i||i.leafInfo==null||i.leafInfo.type==="single-content"||this.#h.has(e.id)){return}i.leafInfo.widgets.push(e);this.#h.set(e.id,{parentLeafId:t,info:e});if(s){this.#g(i.leafInfo,e);n(this);n(this.#p)}else{this.#p.refreshLeaf(t)}}async removeView(t,e){const s=this.#u.get(t);if(!s){return{success:false,reconnectedSubtree:undefined}}const i=s.leafInfo;if(i==null||i.type==="single-content"){return{success:false,reconnectedSubtree:undefined}}const o=await this.#p.removeView(t);if(!o.success){return o}const r=o.reconnectedSubtree;if(r){const t=this.#u.get(r.nodeToRemove);if(t.leafInfo==null){const e=t.item.items;const s=this.#u.get(r.nodeToReconnect);e.forEach((t=>{this.#u.get(t.id).parentItem=s.item}))}else{const e=this.#u.get(r.nodeToReconnect);e.leafInfo=t.leafInfo;const s=e.leafInfo;s.id=r.nodeToReconnect;const n=s.type==="single-content"?[s.widget]:s.widgets;n.forEach((t=>{const e=this.#h.get(t.id);e.parentLeafId=s.id}))}this.#u.delete(r.nodeToRemove)}if(e){i.widgets.forEach(this.#b)}this.#u.delete(t);n(this);return o}async removeWidget(t){const e=this.#h.get(t);if(!e){return}const s=this.#r(e.parentLeafId);if(s.type==="single-content"){return}this.#x(s,e.info,s.widgets.findIndex((e=>e.id===t)))}#m=t=>{if(t==null){return}const e=new Set;$(t,this.#u,e,this.#d,this.#h);this.#f=[...e.values()].join(",")};#r=t=>P(this.#u,t);#w=t=>{t.stopPropagation();const e=t.detail;const s=this.#r(e.viewId);const i=s.widgets[e.newSelectedIndex];this.#g(s,i);n(this);n(this.#p)};#y=t=>{t.stopPropagation();const e=t.detail;const s=this.#r(e.viewId);const n=e.itemIndex;const i=s.widgets[n];this.#x(s,i,n)};#x=(t,e,s)=>{if(t.widgets.length===1){this.removeView(t.id,true);return}const i=t.widgets;const o=t.widgets.length;if(e.id===t.selectedWidgetId){const e=s===o-1?i[o-2]:i[s+1];this.#g(t,e)}this.#I(t,s);n(this);n(this.#p)};#I=(t,e,s=false)=>{const n=d(t.widgets,e);this.#p.removeItemPageInView(t.id,n.id);if(!s){this.#b(n)}};#b=t=>{if(t.conserveRenderState===true){return}this.#d.delete(t.id);this.#h.delete(t.id)};#g=(t,e)=>{this.#d.add(e.id);e.wasRendered=true;t.selectedWidgetId=e.id};#v=async t=>{const e=t.detail;const s=e.viewId;const i=e.viewIdTarget;const o=e.dropAreaTarget;const r=this.#r(s);if(s===i&&(o==="center"||r.widgets.length===1)){return}const a=this.#r(i);const l=e.index;const c=r.widgets[l];this.#h.get(c.id).parentLeafId=i;this.#d.add(c.id);c.wasRendered=true;if(o==="center"){a.widgets.push(c);this.#g(a,c)}else{await this.#k(c,a,o)}if(r.widgets.length===1){await this.removeView(s,false)}else{if(r.selectedWidgetId===c.id){const t=l===0?1:l-1;const e=r.widgets[t];this.#g(r,e)}this.#I(r,l,true);n(this)}};#k=async(t,e,s)=>{const n=this.#u.get(e.id);const i=n.parentItem;const o=E();const r={id:o,selectedWidgetId:t.id,size:undefined,tabDirection:n.leafInfo.tabDirection,type:"tabbed",widgets:[t],dragBar:{size:n.item.dragBar?.size,part:n.item.dragBar?.part}};const a=i.direction==="rows"&&(s==="block-start"||s==="block-end")||i.direction==="columns"&&(s==="inline-start"||s==="inline-end");if(a){await this.addSiblingView(i.id,e.id,s==="block-start"||s==="inline-start"?"before":"after",r,true)}};#C=t=>{const e=this.#h.get(t).info;const s=this.renders[e.renderId??t];return e.addWrapper?i("div",{key:t,slot:t,class:"ch-flexible-layout-render-slot"},s(e)):s(e)};componentWillLoad(){this.#m(this.model)}render(){if(this.model==null){return""}return i("ch-flexible-layout",{class:this.cssClass||null,model:this.model,layoutSplitterParts:this.#f,itemsInfo:this.#u,onViewItemClose:this.#y,onViewItemReorder:this.#v,onSelectedViewItemChange:this.#w,ref:t=>this.#p=t},[...this.#d.values()].map(this.#C))}static get watchers(){return{model:["modelChanged"]}}};H.style=T;export{B as ch_flexible_layout,H as ch_flexible_layout_render};
//# sourceMappingURL=p-f9a30cd5.entry.js.map