import{r as t,g as e,h as s,H as n}from"./p-7af91c05.js";import{f as r}from"./p-b3df8b9e.js";const i=new Map;let o;function c(t,e,s){s.forEach((s=>{const n=p(s.keyShortcuts);n.forEach((n=>{const r=w(n.ctrl,n.alt,n.shift,n.meta,n.key);i.set(r,{name:t,root:e,shortcut:s})}))}));l()}function u(t){const e=[];i.forEach(((s,n)=>{if(s.name===t){e.push(n)}}));e.forEach((t=>i.delete(t)));f()}function a(t){return Array.from(i.values()).filter((e=>e.name===t&&!e.shortcut.conditions?.focusInclude)).map((t=>({element:y(t.shortcut.selector,t.root),keyShortcuts:t.shortcut.keyShortcuts,legendPosition:t.shortcut.legendPosition})))}function l(){if(i.size>0){window.addEventListener("keydown",h,{capture:true})}}function f(){if(i.size===0){window.removeEventListener("keydown",h,{capture:true})}}function h(t){if(!t.repeat||t.repeat&&o?.shortcut.conditions?.allowRepeat){o=d(t)}}function d(t){const e=w(t.ctrlKey,t.altKey,t.shiftKey,t.metaKey,t.key);const s=i.get(e);const n=r();if(s&&k(s,n)){const r=y(s.shortcut.selector,s.root);const i=b(e,s.shortcut.id,r,n);if(s.root.dispatchEvent(i)){switch(s.shortcut.action){case"click":r?.dispatchEvent(new Event("click"));break;default:r?.focus()}if(s.shortcut.preventDefault!==false){t.preventDefault()}}else{t.preventDefault()}}return s}function p(t=""){return t.split(/(?<!(?:[+]|^))\s/).map((t=>t.split(/(?<!(?:[+]|^))[+]/).reduce(((t,e)=>{switch(e.toLowerCase()){case"ctrl":t.ctrl=true;break;case"alt":t.alt=true;break;case"shift":t.shift=true;break;case"meta":t.meta=true;break;default:t.key=e}return t}),{ctrl:false,alt:false,shift:false,meta:false,key:""})))}function w(t,e,s,n,r){return[t?"Ctrl":null,e?"Alt":null,s?"Shift":null,n?"Meta":null,r?r.charAt(0).toUpperCase()+r.slice(1):null].filter((t=>t!==null)).join("+")}function k(t,e){if(t.shortcut.conditions?.focusInclude){return m(t.shortcut.conditions.focusInclude,t.root).some((t=>e.includes(t)))}if(t.shortcut.conditions?.focusExclude){return!m(t.shortcut.conditions.focusExclude,t.root).some((t=>e.includes(t)))}return true}function b(t,e,s,n){return new CustomEvent("keyShortcutPressed",{bubbles:true,cancelable:true,composed:false,detail:{keyShortcut:t,id:e,target:s,focusComposedPath:n}})}function m(t,e){return t?.split(",").map((s=>{if(t.includes("::part")){return y(s,e)}return Array.from(e.querySelectorAll(t))})).flat()??[]}function y(t,e){const s=(t,e)=>{const n=t.shadowRoot;const r=e.split(" ");const i=n.querySelector(r.map((t=>`[part~="${t}"]`)).join(""));if(i){return i}const o=n.querySelector(r.map((t=>`[exportparts*="${t}"]`)).join(""));if(o){const t=[];const e=o.getAttribute("exportparts");r.forEach((s=>{const n=e.match(`(?:([\\w-]+):)?(${s})`)[1];if(n){t.push(n)}}));if(r.length===t.length){return s(o,t.join(" "))}}return null};if(t?.includes("::part")){const n=t.match("(.*)::part\\(([^)]+)\\)");const r=n[1];const i=n[2];return s(e.querySelector(r),i)}return e.querySelector(t)}const C=":host{display:contents}";const g=C;const S={" ":"âŒ´"};const A=class{constructor(e){t(this,e);this.showShortcuts=false;this.src=undefined;this.showKey="F10";this.suspend=false}shortcuts;get el(){return e(this)}suspendHandler(){if(this.suspend){u(this.src)}else{const t=this.el.getRootNode();c(this.src,t,this.shortcuts)}}componentDidLoad(){if(this.src){fetch(this.src).then((t=>{if(t.ok){t.json().then((t=>{const e=this.el.getRootNode();this.shortcuts=t;c(this.src,e,this.shortcuts)}))}}))}}disconnectedCallback(){u(this.src)}windowKeyDownHandler(t){const e=["Ctrl","Alt","Shift","Meta"];if(t.repeat||this.suspend){return}if(t.key===this.showKey){this.showShortcuts=!this.showShortcuts;t.preventDefault()}else if(this.showShortcuts&&!e.includes(t.key)){this.showShortcuts=false}}windowClosedHandler=()=>{this.showShortcuts=false};renderShortcuts(){return a(this.src).filter((t=>t.element)).map((t=>s("ch-window",{container:t.element,modal:false,hidden:false,closeOnEscape:true,closeOnOutsideClick:true,xAlign:"outside-end",yAlign:"inside-start",onWindowClosed:this.windowClosedHandler,exportparts:"mask:element, main:tooltip"},this.renderKeyShortcuts(t.keyShortcuts))))}renderKeyShortcuts(t){return t.split(/(?<!(?:[+]|^))([+\s])/).map(((t,e,n)=>{if(t==="+"&&e>0&&n[e-1]!=="+"){return s("span",{part:"plus"},"+")}if(t===" "&&e>0&&n[e-1]!=="+"){return s("span",{part:"slash"},"/")}return s("kbd",{part:`key`},S[t]??t)}))}render(){return s(n,{key:"92d5871056ed3fb105566293d1e9b67d698b51df"},this.showShortcuts&&this.renderShortcuts())}static get watchers(){return{suspend:["suspendHandler"]}}};A.style=g;export{A as ch_shortcuts};
//# sourceMappingURL=p-29bf6a99.entry.js.map